{
    "componentChunkName": "component---src-templates-course-content-template-js",
    "path": "/part-3/2-deployment-pipelines",
    "result": {"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/CI/CD","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"CI/CD"}]},{"type":"text","value":" pipeline (sometimes called deployment pipeline) is a corner stone of DevOps. According "},{"type":"element","tagName":"a","properties":{"href":"https://www.redhat.com/en/topics/devops/what-cicd-pipeline","target":"_blank","rel":["noopener","noreferrer"]},"children":[]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"According to "},{"type":"element","tagName":"a","properties":{"href":"https://about.gitlab.com/topics/ci-cd/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Gitlab"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"CI/CD automates much or all of the manual human intervention traditionally needed to get new code from a commit into production. With a CI/CD pipeline, development teams can make changes to code that are then automatically tested and pushed out for delivery and deployment. Get CI/CD right and downtime is minimized and code releases happen faster."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us now see how one can set up a deployment pipeline using "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/features/actions","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"GitHub Actions"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://containrrr.dev/watchtower/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Watchtower"}]},{"type":"text","value":" that can be used to automatically deploy containerized software to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"any"}]},{"type":"text","value":" machine. So every time you commit the code in your machine, the pipeline builds the image and starts it up in the server."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since we cannot assume that everyone has access to their own server, we will demonstrate the pipeline using "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"a local machine"}]},{"type":"text","value":" as the development target, but the exactly same steps can be used for Raspberry Pi or even a virtual machine in the cloud (such as one provided by "},{"type":"element","tagName":"a","properties":{"href":"https://www.hetzner.com/cloud","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Hetzner"}]},{"type":"text","value":")."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We will use GitHub Actions to build an image, push the image to Docker Hub, and then use a project called \"Watchtower\" automatically pull the image from there."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As example, we will look repository "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/docker-hy.github.io","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/docker-hy/docker-hy.github.io"}]},{"type":"text","value":", that is, the material of this course."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As was said "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/features/actions","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"GitHub Actions"}]},{"type":"text","value":" is used to implement one part of the deployment pipeline. The "},{"type":"element","tagName":"a","properties":{"href":"https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" gives the following overview:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"GitHub Actions is a continuous integration and continuous delivery (CI/CD) platform that allows you to automate your build, test, and deployment pipeline. You can create workflows that build and test commit and every pull request to your repository, or deploy merged pull requests to production."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The project defines a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"workflow"}]},{"type":"text","value":" with GitHub Actions that builds a Docker image and pushes it to Docker Hub every time the code is pushed to the GitHub repository."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us now see how the workflow definition looks. It is stored in the file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"build.yml"}]},{"type":"text","value":" inside the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":".github/workflows"}]},{"type":"text","value":" directory:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Release DevOps with Docker "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Name of the workflow"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# On a push to the branch named master"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"branches"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" master\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Job called build runs-on ubuntu-latest"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"runs-on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ubuntu"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"steps"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Checkout to the repository"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" actions/checkout@v2\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# We need to login so we can later push the image without issues."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Login to Docker Hub\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" docker/login"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"action@v1\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"username"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_USERNAME "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"password"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_TOKEN "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Builds devopsdockeruh/docker-hy.github.io"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and push\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" docker/build"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"push"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"action@v2\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"tags"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" devopsdockeruh/coursepage"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"latest"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"a","properties":{"href":"https://docs.github.com/en/actions/using-workflows","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"workflow"}]},{"type":"text","value":" has one "},{"type":"element","tagName":"a","properties":{"href":"https://docs.github.com/en/actions/using-jobs/using-jobs-in-a-workflow","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"job"}]},{"type":"text","value":" that consists of series of "},{"type":"element","tagName":"a","properties":{"href":"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsteps","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"steps"}]},{"type":"text","value":". Each step is a small operation or "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"action"}]},{"type":"text","value":" that does its part of the whole. The steps are the following"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/actions/checkout","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"actions/checkout@v2"}]},{"type":"text","value":" is used to check out the code from the repository"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker/login-action","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"docker/login-action@v1"}]},{"type":"text","value":" is used to log in to Docker Hub"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker/build-push-action","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"docker/build-push-action@v2"}]},{"type":"text","value":" is used to build the image and push it to Docke rHub"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first action was one of the ready made actions that GitHub provides. The latter two are official actions offered by "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Docker"}]},{"type":"text","value":". See "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/marketplace/actions/build-and-push-docker-images","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":" for more info about the official Docker GitHub Actions."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before the workflow will work, two "},{"type":"element","tagName":"a","properties":{"href":"https://docs.github.com/en/actions/security-guides/encrypted-secrets","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"secrets"}]},{"type":"text","value":" should be added to the GitHub repository: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DOCKERHUB_TOKEN"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DOCKERHUB_USERNAME"}]},{"type":"text","value":". This is done by opening the repository in browser and first pressing "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Settings"}]},{"type":"text","value":" then "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Secrets"}]},{"type":"text","value":". The "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"DOCKERHUB_TOKEN"}]},{"type":"text","value":" can be created in Docker Hub from the  "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Account Settings / Security"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"GitHub Actions are doing only the \"first half\" of the deployment pipeline: they are ensuring that every push to GitHub is built to an Docker image that is pushed to Docker Hub."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The other half of the deployment pipeline is implemented by a containerized service called "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/containrrr/watchtower","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Watchtower"}]},{"type":"text","value":" that is an open source project that automates the task of updating images. Watchtower will poll the source of the image (in this case Docker Hub) for changes in the containers that are running. The container that is running will be updated and automatically restarted when a new version of the image is pushed to Docker Hub. Watchtower respects tags e.g. container using ubuntu:18.04 will not be updated unless a new version of ubuntu:18.04 is released."}]},{"type":"element","tagName":"text-box","properties":{"name":"Security reminder: Docker Hub accessing your computer","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that now anyone with access to your Docker Hub also has access to your PC through this. If they push a malicious update to your application, Watchtower will happily download and start the updated version."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Watchtower can be run eg. using the following Docker Compose file:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"watchtower"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" containrrr/watchtower\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"  WATCHTOWER_POLL_INTERVAL=60 "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Poll every 60 seconds"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" /var/run/docker.sock"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/var/run/docker.sock\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" watchtower"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"One needs to be careful when starting Watchtower with "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"docker compose up"}]},{"type":"text","value":",  since it will try to update "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"every"}]},{"type":"text","value":" image running the machine. The "},{"type":"element","tagName":"a","properties":{"href":"https://containrrr.github.io/watchtower/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" describes how this can be prevented."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 3.1: Your pipeline"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create now a similar deployment pipeline to a simple NodeJS/Express app found\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/material-applications/tree/main/express-app","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Either for the project or copy the files to your own repository. Set up simillar deployment pipeline (or the \"first half\") using GitHub Actions that was just described. Ensure that a new image gets pushed to Docker Hub every time you push the code to GitHub (you may eg. change the message the app shows)."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that there is a importat change that you should make to the above the workflow configuration, the branch should be named "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"main"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Release NodeJS app\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"branches"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" main\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"runs-on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ubuntu"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"steps"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# ..."}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The earlier example still uses the old GitHub naming convention and calls the main branch "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"master"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some of the action that the above example uses are a bit outdated, so go throug the documentation"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/actions/checkout","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"actions/checkout"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker/login-action","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"docker/login-action"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"[docker/build-push-action]("},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/docker/"}]}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"and use the most recent versions in your workflow. Keep on eye the GitHub Actions page to see that your actions are working:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/e76e020c262b701c523d84a35f7ac4f4/895f3/gha.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVQoz4WQa2/SYBTH+x1847xsyLWlpS2M0gu3pWCi326MjcQY4/fShS1RgT6w9rn0gd4fUzVoBurJ78VJTn45/3O4O4fOV/TTgt4uKXCRvw38XUh3ob8NaN4ELsQuxEuwcSH2EHE2LqEBxP4KbDhCKcbE9ynC5MFDCOK1A1yI1y6E2PcQcSFGhHqIQOxvXIgIDaI4iJIwSrn1Cjx4KAgjxliWZSxj/600zaI4SdKUW375ignZD3xKl6sVWK8PcQBwHAcA8G2x+Hw7n9/fc7sgYFm+Lo5jxtj7Dx9VzWybA6VtqpqptH+j9+2e/cYYjPWebfRHxsDmMERxkkZxvN3tGGOT6ezktCw1O8WaVKjUX9WkPWVBrtTVsiCX+JyyIHMI4SRN4yTJIzB2eXXzsshbw7Ha6Sptk5daPxylIihlQX4E53kw+yP21exdpVQfjt92R3nCxrklNnWpZRwll8Mw3MvT69nZs8KoZw96dte6sMzheUuXxaYkKIdw+z//lCfT2dPnBcMatjRLkJq1usKLak1Qqrx8yGP5cnrzosjrfbtl9NvmQGp2Snzj8NpfNx+Ta9bwtap164omqtrfzCPy5Hr25ORUVLWqqJb4xj/WVkX1OxGovCVIt6b1AAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/e76e020c262b701c523d84a35f7ac4f4/a0b58/gha.webp 230w","/static/e76e020c262b701c523d84a35f7ac4f4/bc10c/gha.webp 460w","/static/e76e020c262b701c523d84a35f7ac4f4/966d8/gha.webp 920w","/static/e76e020c262b701c523d84a35f7ac4f4/445df/gha.webp 1380w","/static/e76e020c262b701c523d84a35f7ac4f4/78de1/gha.webp 1840w","/static/e76e020c262b701c523d84a35f7ac4f4/d55fd/gha.webp 2158w"],"sizes":"(max-width: 920px) 100vw, 920px","type":"image/webp"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/e76e020c262b701c523d84a35f7ac4f4/81c8e/gha.png 230w","/static/e76e020c262b701c523d84a35f7ac4f4/08a84/gha.png 460w","/static/e76e020c262b701c523d84a35f7ac4f4/c0255/gha.png 920w","/static/e76e020c262b701c523d84a35f7ac4f4/b1001/gha.png 1380w","/static/e76e020c262b701c523d84a35f7ac4f4/161ec/gha.png 1840w","/static/e76e020c262b701c523d84a35f7ac4f4/895f3/gha.png 2158w"],"sizes":"(max-width: 920px) 100vw, 920px","type":"image/png"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/e76e020c262b701c523d84a35f7ac4f4/c0255/gha.png","alt":"gha","title":"gha","loading":"lazy","decoding":"async","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ensure also from Docker Hub that your image gets pushed there."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next, run your image locally in detached mode, and ensure that you can acces it with browser."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now set up and run the "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/containrrr/watchtower","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Watchtower"}]},{"type":"text","value":" just as described above."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You might do these two in a single step as it was done above so that they share the Docker Compose"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now your deployment pipeline is set up! Ensure that it works:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"make a change your code"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"commit and push the changes to GitHub"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"wait for some time (the time it takes for GitHub Action to build and push the image and the Watchtower poll interval)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"reload the browser to ensure that Watchtower has started the new version (that is, your changes are visible)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit a link to the repository with the config."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 3.2: A deployment pipeline to a cloud service"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In "},{"type":"element","tagName":"a","properties":{"href":"/part-1/6-docker-hub#non-tmc-exercise-exercise-116-cloud-deployment"},"children":[{"type":"text","value":"Exercise 1.16"}]},{"type":"text","value":" you deployed a containerized to cloud."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now it is time to improvement your solution by building it a deployment pipeline, so thate every push to GitHub results a new deployment to the cloud service."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You will most likely find a ready made GitHub Action that does most of the heavy lifting your you..."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit a link to the repository with the config."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 3.3: Building images inside of a container"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Watchtower uses volume to docker.sock socket to access Docker daemon of the host from the container. By leveraging this ourselves we can create our own simple build service."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Create a project that downloads a repository from github, builds a Dockerfile located in the root and then publishes it into Docker Hub."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can use any programming language / technology for the project implementation. A simple bash script is viable."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then create a Dockerfile for it so that it can be run inside a container."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Make sure that it can build at least some of the example projects."}]}]}]},"html":"<div><p><a href=\"https://en.wikipedia.org/wiki/CI/CD\" target=\"_blank\" rel=\"noopener noreferrer\">CI/CD</a> pipeline (sometimes called deployment pipeline) is a corner stone of DevOps. According <a href=\"https://www.redhat.com/en/topics/devops/what-cicd-pipeline\" target=\"_blank\" rel=\"noopener noreferrer\"></a>.</p><p>According to <a href=\"https://about.gitlab.com/topics/ci-cd/\" target=\"_blank\" rel=\"noopener noreferrer\">Gitlab</a>:</p><p><em>CI/CD automates much or all of the manual human intervention traditionally needed to get new code from a commit into production. With a CI/CD pipeline, development teams can make changes to code that are then automatically tested and pushed out for delivery and deployment. Get CI/CD right and downtime is minimized and code releases happen faster.</em></p><p>Let us now see how one can set up a deployment pipeline using <a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub Actions</a> and <a href=\"https://containrrr.dev/watchtower/\" target=\"_blank\" rel=\"noopener noreferrer\">Watchtower</a> that can be used to automatically deploy containerized software to <em>any</em> machine. So every time you commit the code in your machine, the pipeline builds the image and starts it up in the server.</p><p>Since we cannot assume that everyone has access to their own server, we will demonstrate the pipeline using <em>a local machine</em> as the development target, but the exactly same steps can be used for Raspberry Pi or even a virtual machine in the cloud (such as one provided by <a href=\"https://www.hetzner.com/cloud\" target=\"_blank\" rel=\"noopener noreferrer\">Hetzner</a>).</p><p>We will use GitHub Actions to build an image, push the image to Docker Hub, and then use a project called \"Watchtower\" automatically pull the image from there.</p><p>As example, we will look repository <a href=\"https://github.com/docker-hy/docker-hy.github.io\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/docker-hy/docker-hy.github.io</a>, that is, the material of this course.</p><p>As was said <a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub Actions</a> is used to implement one part of the deployment pipeline. The <a href=\"https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a> gives the following overview:</p><p><em>GitHub Actions is a continuous integration and continuous delivery (CI/CD) platform that allows you to automate your build, test, and deployment pipeline. You can create workflows that build and test commit and every pull request to your repository, or deploy merged pull requests to production.</em></p><p>The project defines a <em>workflow</em> with GitHub Actions that builds a Docker image and pushes it to Docker Hub every time the code is pushed to the GitHub repository.</p><p>Let us now see how the workflow definition looks. It is stored in the file <em>build.yml</em> inside the <em>.github/workflows</em> directory:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Release DevOps with Docker <span class=\"token comment\"># Name of the workflow</span>\n\n<span class=\"token comment\"># On a push to the branch named master</span>\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n\n<span class=\"token comment\"># Job called build runs-on ubuntu-latest</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Checkout to the repository</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n\n    <span class=\"token comment\"># We need to login so we can later push the image without issues.</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Docker Hub\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v1\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token comment\"># Builds devopsdockeruh/docker-hy.github.io</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and push\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v2\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> devopsdockeruh/coursepage<span class=\"token punctuation\">:</span>latest</code></pre></div><p>The <a href=\"https://docs.github.com/en/actions/using-workflows\" target=\"_blank\" rel=\"noopener noreferrer\">workflow</a> has one <a href=\"https://docs.github.com/en/actions/using-jobs/using-jobs-in-a-workflow\" target=\"_blank\" rel=\"noopener noreferrer\">job</a> that consists of series of <a href=\"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsteps\" target=\"_blank\" rel=\"noopener noreferrer\">steps</a>. Each step is a small operation or <em>action</em> that does its part of the whole. The steps are the following</p><ul>\n<li><a href=\"https://github.com/actions/checkout\" target=\"_blank\" rel=\"noopener noreferrer\">actions/checkout@v2</a> is used to check out the code from the repository</li>\n<li><a href=\"https://github.com/docker/login-action\" target=\"_blank\" rel=\"noopener noreferrer\">docker/login-action@v1</a> is used to log in to Docker Hub</li>\n<li><a href=\"https://github.com/docker/build-push-action\" target=\"_blank\" rel=\"noopener noreferrer\">docker/build-push-action@v2</a> is used to build the image and push it to Docke rHub</li>\n</ul><p>The first action was one of the ready made actions that GitHub provides. The latter two are official actions offered by <a href=\"https://github.com/docker\" target=\"_blank\" rel=\"noopener noreferrer\">Docker</a>. See <a href=\"https://github.com/marketplace/actions/build-and-push-docker-images\" target=\"_blank\" rel=\"noopener noreferrer\">here</a> for more info about the official Docker GitHub Actions.</p><p>Before the workflow will work, two <a href=\"https://docs.github.com/en/actions/security-guides/encrypted-secrets\" target=\"_blank\" rel=\"noopener noreferrer\">secrets</a> should be added to the GitHub repository: <code class=\"language-text\">DOCKERHUB_TOKEN</code> and <code class=\"language-text\">DOCKERHUB_USERNAME</code>. This is done by opening the repository in browser and first pressing <em>Settings</em> then <em>Secrets</em>. The <code class=\"language-text\">DOCKERHUB_TOKEN</code> can be created in Docker Hub from the  <em>Account Settings / Security</em>.</p><p>GitHub Actions are doing only the \"first half\" of the deployment pipeline: they are ensuring that every push to GitHub is built to an Docker image that is pushed to Docker Hub.</p><p>The other half of the deployment pipeline is implemented by a containerized service called <a href=\"https://github.com/containrrr/watchtower\" target=\"_blank\" rel=\"noopener noreferrer\">Watchtower</a> that is an open source project that automates the task of updating images. Watchtower will poll the source of the image (in this case Docker Hub) for changes in the containers that are running. The container that is running will be updated and automatically restarted when a new version of the image is pushed to Docker Hub. Watchtower respects tags e.g. container using ubuntu:18.04 will not be updated unless a new version of ubuntu:18.04 is released.</p><text-box name=\"Security reminder: Docker Hub accessing your computer\" variant=\"hint\"><p>Note that now anyone with access to your Docker Hub also has access to your PC through this. If they push a malicious update to your application, Watchtower will happily download and start the updated version.</p></text-box><p>Watchtower can be run eg. using the following Docker Compose file:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">watchtower</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> containrrr/watchtower\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span>  WATCHTOWER_POLL_INTERVAL=60 <span class=\"token comment\"># Poll every 60 seconds</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> watchtower</code></pre></div><p>One needs to be careful when starting Watchtower with <em>docker compose up</em>,  since it will try to update <strong>every</strong> image running the machine. The <a href=\"https://containrrr.github.io/watchtower/\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a> describes how this can be prevented.</p><exercise name=\"Exercise 3.1: Your pipeline\"><p>Create now a similar deployment pipeline to a simple NodeJS/Express app found\n<a href=\"https://github.com/docker-hy/material-applications/tree/main/express-app\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>.</p><p>Either for the project or copy the files to your own repository. Set up simillar deployment pipeline (or the \"first half\") using GitHub Actions that was just described. Ensure that a new image gets pushed to Docker Hub every time you push the code to GitHub (you may eg. change the message the app shows).</p><p>Note that there is a importat change that you should make to the above the workflow configuration, the branch should be named <em>main</em>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Release NodeJS app\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># ...</span></code></pre></div><p>The earlier example still uses the old GitHub naming convention and calls the main branch <em>master</em>.</p><p>Some of the action that the above example uses are a bit outdated, so go throug the documentation</p><ul>\n<li><a href=\"https://github.com/actions/checkout\" target=\"_blank\" rel=\"noopener noreferrer\">actions/checkout</a></li>\n<li><a href=\"https://github.com/docker/login-action\" target=\"_blank\" rel=\"noopener noreferrer\">docker/login-action</a></li>\n<li>[docker/build-push-action](<a href=\"https://github.com/docker/\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/docker/</a></li>\n</ul><p>and use the most recent versions in your workflow. Keep on eye the GitHub Actions page to see that your actions are working:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/e76e020c262b701c523d84a35f7ac4f4/895f3/gha.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVQoz4WQa2/SYBTH+x1847xsyLWlpS2M0gu3pWCi326MjcQY4/fShS1RgT6w9rn0gd4fUzVoBurJ78VJTn45/3O4O4fOV/TTgt4uKXCRvw38XUh3ob8NaN4ELsQuxEuwcSH2EHE2LqEBxP4KbDhCKcbE9ynC5MFDCOK1A1yI1y6E2PcQcSFGhHqIQOxvXIgIDaI4iJIwSrn1Cjx4KAgjxliWZSxj/600zaI4SdKUW375ignZD3xKl6sVWK8PcQBwHAcA8G2x+Hw7n9/fc7sgYFm+Lo5jxtj7Dx9VzWybA6VtqpqptH+j9+2e/cYYjPWebfRHxsDmMERxkkZxvN3tGGOT6ezktCw1O8WaVKjUX9WkPWVBrtTVsiCX+JyyIHMI4SRN4yTJIzB2eXXzsshbw7Ha6Sptk5daPxylIihlQX4E53kw+yP21exdpVQfjt92R3nCxrklNnWpZRwll8Mw3MvT69nZs8KoZw96dte6sMzheUuXxaYkKIdw+z//lCfT2dPnBcMatjRLkJq1usKLak1Qqrx8yGP5cnrzosjrfbtl9NvmQGp2Snzj8NpfNx+Ta9bwtap164omqtrfzCPy5Hr25ORUVLWqqJb4xj/WVkX1OxGovCVIt6b1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/e76e020c262b701c523d84a35f7ac4f4/a0b58/gha.webp 230w,\n/static/e76e020c262b701c523d84a35f7ac4f4/bc10c/gha.webp 460w,\n/static/e76e020c262b701c523d84a35f7ac4f4/966d8/gha.webp 920w,\n/static/e76e020c262b701c523d84a35f7ac4f4/445df/gha.webp 1380w,\n/static/e76e020c262b701c523d84a35f7ac4f4/78de1/gha.webp 1840w,\n/static/e76e020c262b701c523d84a35f7ac4f4/d55fd/gha.webp 2158w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n          <source srcset=\"/static/e76e020c262b701c523d84a35f7ac4f4/81c8e/gha.png 230w,\n/static/e76e020c262b701c523d84a35f7ac4f4/08a84/gha.png 460w,\n/static/e76e020c262b701c523d84a35f7ac4f4/c0255/gha.png 920w,\n/static/e76e020c262b701c523d84a35f7ac4f4/b1001/gha.png 1380w,\n/static/e76e020c262b701c523d84a35f7ac4f4/161ec/gha.png 1840w,\n/static/e76e020c262b701c523d84a35f7ac4f4/895f3/gha.png 2158w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/e76e020c262b701c523d84a35f7ac4f4/c0255/gha.png\" alt=\"gha\" title=\"gha\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span><p>Ensure also from Docker Hub that your image gets pushed there.</p><p>Next, run your image locally in detached mode, and ensure that you can acces it with browser.</p><p>Now set up and run the <a href=\"https://github.com/containrrr/watchtower\" target=\"_blank\" rel=\"noopener noreferrer\">Watchtower</a> just as described above.</p><p>You might do these two in a single step as it was done above so that they share the Docker Compose</p><p>Now your deployment pipeline is set up! Ensure that it works:</p><ul>\n<li>\n<p>make a change your code</p>\n</li>\n<li>\n<p>commit and push the changes to GitHub</p>\n</li>\n<li>\n<p>wait for some time (the time it takes for GitHub Action to build and push the image and the Watchtower poll interval)</p>\n</li>\n<li>\n<p>reload the browser to ensure that Watchtower has started the new version (that is, your changes are visible)</p>\n<p>Submit a link to the repository with the config.</p>\n</li>\n</ul></exercise><exercise name=\"Exercise 3.2: A deployment pipeline to a cloud service\"><p>In <a href=\"/part-1/6-docker-hub#non-tmc-exercise-exercise-116-cloud-deployment\">Exercise 1.16</a> you deployed a containerized to cloud.</p><p>Now it is time to improvement your solution by building it a deployment pipeline, so thate every push to GitHub results a new deployment to the cloud service.</p><p>You will most likely find a ready made GitHub Action that does most of the heavy lifting your you...</p><p>Submit a link to the repository with the config.</p></exercise><exercise name=\"Exercise 3.3: Building images inside of a container\"><p>Watchtower uses volume to docker.sock socket to access Docker daemon of the host from the container. By leveraging this ourselves we can create our own simple build service.</p><p>Create a project that downloads a repository from github, builds a Dockerfile located in the root and then publishes it into Docker Hub.</p><p>You can use any programming language / technology for the project implementation. A simple bash script is viable.</p><p>Then create a Dockerfile for it so that it can be run inside a container.</p><p>Make sure that it can build at least some of the example projects.</p></exercise></div>","frontmatter":{"path":"/part-3/2-deployment-pipelines","title":"Deployment pipelines"},"fileAbsolutePath":"/home/runner/work/docker-hy.github.io/docker-hy.github.io/data/part-3/section-2.md"},"allPages":{"edges":[{"node":{"id":"4352ae37-1cc5-5973-956b-aa3c8cc1a438","frontmatter":{"path":"/faq","title":"Frequently asked questions"}}},{"node":{"id":"e1238e90-e69f-5b89-ae7f-7a3890359b73","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"3cb91679-41d9-585e-8746-8d7f0fbc121a","frontmatter":{"path":"/getting-started","title":"Getting started"}}},{"node":{"id":"cc180895-565d-5264-95c9-d15f066c38c3","frontmatter":{"path":"/","title":"About this course"}}},{"node":{"id":"0601dd7a-78da-53bb-9402-15fadc681ddc","frontmatter":{"path":"/links","title":"Links"}}},{"node":{"id":"6c9405c1-39a6-56b2-934e-33850f881070","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"c5438964-0c78-52f9-b28f-f73711d88666","frontmatter":{"path":"/part-1/1-getting-started","title":"Definitions and basic concepts"}}},{"node":{"id":"a8076827-affa-555a-b777-dba87c8e257f","frontmatter":{"path":"/part-1/2-running-and-stopping","title":"Running and stopping containers"}}},{"node":{"id":"d1d17462-978a-5516-8207-0fff56d3d301","frontmatter":{"path":"/part-1/3-in-depth-dive-to-images","title":"In-depth dive to images"}}},{"node":{"id":"b86409c3-2663-57ce-9a34-5ba818f8c6f7","frontmatter":{"path":"/part-1/4-defining-start-conditions","title":"Defining start conditions for the container"}}},{"node":{"id":"f0602d39-4b70-5d33-81a1-44c74bc6a963","frontmatter":{"path":"/part-1/5-volumes-and-ports","title":"Interacting with the container via volumes and ports"}}},{"node":{"id":"eb754b3f-0629-5970-a322-6a4dc4564d67","frontmatter":{"path":"/part-1/6-docker-hub","title":"Utilizing tools from the Registry"}}},{"node":{"id":"d1c71e59-47d3-54fd-a486-383c8377fe36","frontmatter":{"path":"/part-1/7-summary","title":"Summary"}}},{"node":{"id":"0c108910-d460-5d9b-8099-772363806cd1","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"5ecd7aff-3a9d-5952-a0e4-50e15971e6be","frontmatter":{"path":"/part-2/1-migrating-to-docker-compose","title":"Migrating to Docker Compose"}}},{"node":{"id":"663340ff-6dff-50cc-9bb2-25940e07ee07","frontmatter":{"path":"/part-2/3-volumes-in-action","title":"Volumes in action"}}},{"node":{"id":"fccc6c0d-db88-5605-9dcf-032a5afa0c28","frontmatter":{"path":"/part-2/4-containers-in-development","title":"Containers in development"}}},{"node":{"id":"4007819b-0805-5da6-bf6a-99ded7c679ba","frontmatter":{"path":"/part-2/2-docker-networking","title":"Docker networking"}}},{"node":{"id":"d765d5bb-ef50-576a-8818-9938b2930e71","frontmatter":{"path":"/part-2/5-summary","title":"Summary"}}},{"node":{"id":"562b2219-bfee-5004-b19d-67666caa20c1","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"a43415c2-1067-541e-83ce-30fbd4938a64","frontmatter":{"path":"/part-3/1-deeper-understainding-of-containers","title":"Official Images and trust"}}},{"node":{"id":"f13c2ceb-97e3-50e6-9153-9fd8c7b4eb5a","frontmatter":{"path":"/part-3/2-deployment-pipelines","title":"Deployment pipelines"}}},{"node":{"id":"baa5a147-830d-5a73-b883-2eef8b123a54","frontmatter":{"path":"/part-3/3-using-non-root-user","title":"Using a non-root user"}}},{"node":{"id":"b172f390-4ffa-568d-99e8-737985f35a70","frontmatter":{"path":"/part-3/4-optimizing-the-image-size","title":"Optimizing the image size"}}},{"node":{"id":"76657527-40ce-5179-88b3-0df3d0ae2ab9","frontmatter":{"path":"/part-3/5-multi-host-environments","title":"Multi-host environments"}}},{"node":{"id":"3405a024-ea45-5fd0-8004-ec8726591ee1","frontmatter":{"path":"/part-3/6-end","title":"End"}}}]}},"pageContext":{}},
    "staticQueryHashes": ["3294351120","994120085"]}