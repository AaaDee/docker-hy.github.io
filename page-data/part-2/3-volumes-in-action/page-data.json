{
    "componentChunkName": "component---src-templates-course-content-template-js",
    "path": "/part-2/3-volumes-in-action",
    "result": {"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Next we're going to set up the project management application "},{"type":"element","tagName":"a","properties":{"href":"https://www.redmine.org/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Redmine"}]},{"type":"text","value":", a PostgreSQL database and "},{"type":"element","tagName":"a","properties":{"href":"https://www.adminer.org/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Adminer"}]},{"type":"text","value":", a graphical interface for database administration."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"All of above have official Docker images available as we can see from "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/redmine","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Redmine"}]},{"type":"text","value":", "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/postgres","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Postgres"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/adminer","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Adminer"}]},{"type":"text","value":" respectively. The officiality of the containers is not that important, just that we can expect that it will have some support. We could also, for example, setup Wordpress or a MediaWiki inside containers in the same manner if you're interested in running existing applications inside Docker. You could even set up a application monitoring tool such as "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/sentry/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Sentry"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/redmine","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/_/redmine"}]},{"type":"text","value":" there is a list of different tagged versions:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/6cf55bd406223486a26ace02123a93c5/01a87/redmine.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 52.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfElEQVQoz22Q2Y7bMAxF/f9f1s4Ek8VJO+kCBNltyRIlUkusrVCCJn4Ygg8HFK7uJZu394/5YvWxWLWbn4tl+zabb358zpft9tff+1O7WK0Px1O73rzP5qt287n9vWzXwyBKKc2377Pd/lBKyTmXUlJKD3hOnjWdP7jhfCCkySj/x1zu/TWXuzilfBX6KhQDNM4zwB4QyPaAvcSz0No4BngRugfUxl2EvgjlbmMV55wFGgZo/e2VKb/8Y0q1Y5pCSnfnMcR9L49M7jrRCb3rxJ8zvwp1ZLA9sl7qDlAZB2QHTVeJDIisl2hyztWZaxLaaGPJeq4e7KQ2Eo0iG2J1CjGNIcaYpidsQgiAhpxXZI3z5PygTSexk/UEXJkjV88rXCWGib6JMSqykiyDmsr5G5DtJFWxrR9dhAay5auqYq6Qgb4MGtBwwPMANbBxnUC0TpEV2vRAAus65PxEnNKJqxOHHnBQtGdwYABkY8p+jCHWbW8h+jGMd47pFfsfFEZ0XG2SDuIAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cf55bd406223486a26ace02123a93c5/a0b58/redmine.webp 230w","/static/6cf55bd406223486a26ace02123a93c5/bc10c/redmine.webp 460w","/static/6cf55bd406223486a26ace02123a93c5/966d8/redmine.webp 920w","/static/6cf55bd406223486a26ace02123a93c5/6f638/redmine.webp 1288w"],"sizes":"(max-width: 920px) 100vw, 920px","type":"image/webp"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cf55bd406223486a26ace02123a93c5/81c8e/redmine.png 230w","/static/6cf55bd406223486a26ace02123a93c5/08a84/redmine.png 460w","/static/6cf55bd406223486a26ace02123a93c5/c0255/redmine.png 920w","/static/6cf55bd406223486a26ace02123a93c5/01a87/redmine.png 1288w"],"sizes":"(max-width: 920px) 100vw, 920px","type":"image/png"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/6cf55bd406223486a26ace02123a93c5/c0255/redmine.png","alt":"redmine","title":"redmine","loading":"lazy","decoding":"async","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can most likely use any of the available images."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"From section "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Environment Variables"}]},{"type":"text","value":" we can see that all versions can use "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"REDMINE_DB_POSTGRES"}]},{"type":"text","value":" environment variable to set up a Postgres database. So before moving forward, let's setup Postgres for us."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/postgres","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/_/postgres"}]},{"type":"text","value":" there's a sample compose file under \"via Docker Stack deploy or Docker Compose\" - Let's strip that down to"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"db"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"13.2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" unless"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stopped\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"POSTGRES_PASSWORD"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" db_redmine"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"restart: always"}]},{"type":"text","value":" was changed to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"unless-stopped"}]},{"type":"text","value":" that will keep the container running unless we explicitely stop it. With "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"always"}]},{"type":"text","value":" the stopped container is started after reboot for example, see "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/config/containers/start-containers-automatically/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":" for more."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Under the section "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-library/docs/blob/master/postgres/README.md#where-to-store-data","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Where to store data"}]},{"type":"text","value":" we can see that the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/var/lib/postgresql/data"}]},{"type":"text","value":" should be mounted separately to preserve the data."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are two options. We could use a bind mount like previously and mount a easy-to-locate directory for storing the data. Let us now use the other opiton, a "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/storage/volumes/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Docker managed volume"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's run the Docker Compose file without setting anything new:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker compose up\n\n  Creating network \"redmine_default\" with the default driver\n  Creating db_redmine ... done\n  Attaching to db_redmine\n  db_redmine | The files belonging to this database system will be owned by user \"postgres\".\n  ...\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv4 address \"0.0.0.0\", port 5432\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv6 address \"::\", port 5432\n  db_redmine | 2019-03-03 10:27:22.979 UTC [1] LOG:  listening on Unix socket \"/var/run/postgresql/.s.PGSQL.5432\"\n  db_redmine | 2019-03-03 10:27:22.995 UTC [50] LOG:  database system was shut down at 2019-03-03 10:27:22 UTC\n  db_redmine | 2019-03-03 10:27:23.002 UTC [1] LOG:  database system is ready to accept connections"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The image initializes the data files in the first start. Let's terminate the container with ^C. Compose uses the current directory as a prefix for container and volume names so that different projects don't clash (The prefix can be overridden with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"COMPOSE_PROJECT_NAME"}]},{"type":"text","value":" environment variable if needed)."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"inspect"}]},{"type":"text","value":" if there was a volume created with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker container inspect db_redmine | grep -A 5 Mounts"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"json"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-json"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-json"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Mounts\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Type\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"volume\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Name\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Source\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/var/lib/docker/volumes/794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df/_data\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","property"]},"children":[{"type":"text","value":"\"Destination\""}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/var/lib/postgresql/data\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"An indeed there is one! So despite we did not configure anything the"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now if we check out "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume ls"}]},{"type":"text","value":" we can see that a volume with name \"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\" exists."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There may be more volumes on your machine. If you want to get rid of them you can use "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume prune"}]},{"type":"text","value":". Let's put the whole \"application\" down now with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose down"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Instead of the randomly named volume we better define one explicitly.\nLet us change the definition as follows:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"db"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"13.2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" unless"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stopped\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"POSTGRES_PASSWORD"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" db_redmine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" database"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/var/lib/postgresql/data\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  database"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now let us check what it looks like:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               redmine_database\n\n$ docker container inspect db_redmine | grep -A 5 Mounts\n\"Mounts\": [\n    {\n        \"Type\": \"volume\",\n        \"Name\": \"redmine_database\",\n        \"Source\": \"/var/lib/docker/volumes/ongoing_redminedata/_data\",\n        \"Destination\": \"/var/lib/postgresql/data\","}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ok, looks a bit more human readable! Now when the Postgres is running, is is time to add "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/redmine","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Redmine"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The container seems to require just two environment variables."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"redmine"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redmine"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"4.1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_POSTGRES=db\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_PASSWORD=example\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 9999"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" db"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notice the "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/compose/compose-file/compose-file-v3/#depends_on","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"text","value":" declaration. This makes sure that the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"db"}]},{"type":"text","value":" service is started first. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"text","value":" does not guarantee that the database is up, just that it is started first. The Postgres server is accessible with DNS name \"db\" from the Redmine service as discussed in the section "},{"type":"element","tagName":"a","properties":{"href":"/part-2/2-docker-networking"},"children":[{"type":"text","value":"Docker networking"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now when you run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose up"}]},{"type":"text","value":" you will see a bunch of database migrations running first."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"  redmine_1  | I, [2019-03-03T10:59:20.956936 #25]  INFO -- : Migrating to Setup (1)\n  redmine_1  | == 1 Setup: migrating =========================================================\n  ...\n  redmine_1  | [2019-03-03 11:01:10] INFO  ruby 2.6.1 (2019-01-30) [x86_64-linux]\n  redmine_1  | [2019-03-03 11:01:10] INFO  WEBrick::HTTPServer#start: pid=1 port=3000"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As the "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/redmine","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" mentions, the image creates files to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/usr/src/redmine/files"}]},{"type":"text","value":" and those are better to be persisted. The Dockerfile has this "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-library/redmine/blob/cea16044e97567c28802fc8cc06f6cd036c49a5c/4.0/Dockerfile#L155","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"line"}]},{"type":"text","value":" where it declares that a volume should be created. Again Docker will create the volume, but it will be handled as an anonymous volume that is not managed by the Docker Compose, so it's better to create it explicitly."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With that in mind, our configuration changes to this:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"3.8\""}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"services"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"db"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"13.2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" unless"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stopped\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"POSTGRES_PASSWORD"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"container_name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" db_redmine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" database"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/var/lib/postgresql/data\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"redmine"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redmine"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"4.1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_POSTGRES=db\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_PASSWORD=example\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 9999"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" files"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"/usr/src/redmine/files\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"depends_on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" db\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"database"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  files"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can use the application with our browser through "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:9999","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:9999"}]},{"type":"text","value":". After some changes inside the application we can inspect the changes that happened in the image and check that no extra meaningful files got written to the container:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker container diff $(docker compose ps -q redmine)\n  C /usr/src/redmine/config/environment.rb\n  ...\n  C /usr/src/redmine/tmp/pdf"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Probably not."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We could  use psql to interact with the Postgres database by running  "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker container exec -it db_redmine psql -U postgres"}]},{"type":"text","value":". (The command "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"exec"}]},{"type":"text","value":"utes psql -U postgres inside the container) The same method can be used to create backups with pg_dump: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker container exec db_redmine pg_dump -U postgres > redmine.dump"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Rather than using the archaic command line interface to access Postgres, let us now set up the database adminer to the application."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After a look at the "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/adminer","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":",\nthe setup is straightforward:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"adminer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" adminer"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"4"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restart"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" always\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" ADMINER_DESIGN=galkaev\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" 8083"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8080"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now when we run the application we can access adminer from "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:8083","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:8083"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/9af398f91fdb8474c8c7046ab32be620/7e318/adminer.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 38.69565217391304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVQY04XOzU6DQBSG4YEZChZCgVGBGUiVRhe1Ir8ZIm69CG/B+9Jqy0yJuqkre2emmibSoD452zffAR+bzXr9Ltp22XCxal9e3xoueNtyseJCcCGa7i2b5uFxPn96XiyWIN2J4zjPc9/zAQRS6AAogX/VdX39pSgKxlgYBLICnSOsG4aqKMZgAGVZ6urE331ZlowxSohumUmWRlF0OLIsTfvrgewHVlWUkOHIjJM0iibE9Yjr67pu/ALkO9t4u0wPTP1yNhmH7jHGZ+MT27Ydx8F99uIqoARp1uzmnp7fZmniuS5CCELY//bechhQIA9Pr+4cWl1MpxhjVVURQr3xJ3HUTc8Zt73yAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9af398f91fdb8474c8c7046ab32be620/a0b58/adminer.webp 230w","/static/9af398f91fdb8474c8c7046ab32be620/bc10c/adminer.webp 460w","/static/9af398f91fdb8474c8c7046ab32be620/966d8/adminer.webp 920w","/static/9af398f91fdb8474c8c7046ab32be620/445df/adminer.webp 1380w","/static/9af398f91fdb8474c8c7046ab32be620/78de1/adminer.webp 1840w","/static/9af398f91fdb8474c8c7046ab32be620/629a2/adminer.webp 1892w"],"sizes":"(max-width: 920px) 100vw, 920px","type":"image/webp"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9af398f91fdb8474c8c7046ab32be620/81c8e/adminer.png 230w","/static/9af398f91fdb8474c8c7046ab32be620/08a84/adminer.png 460w","/static/9af398f91fdb8474c8c7046ab32be620/c0255/adminer.png 920w","/static/9af398f91fdb8474c8c7046ab32be620/b1001/adminer.png 1380w","/static/9af398f91fdb8474c8c7046ab32be620/161ec/adminer.png 1840w","/static/9af398f91fdb8474c8c7046ab32be620/7e318/adminer.png 1892w"],"sizes":"(max-width: 920px) 100vw, 920px","type":"image/png"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/9af398f91fdb8474c8c7046ab32be620/c0255/adminer.png","alt":"adminer","title":"adminer","loading":"lazy","decoding":"async","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Setting up the adminer is straightforward since it will be able to access the database through Docker network. You may wonder how adminer finds the Postgres database container? We provide this information to Redmine using an environment variable:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"redmine"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" REDMINE_DB_POSTGRES=db"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Adminer actually assumes that the database has DN Sname  "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"db"}]},{"type":"text","value":" so with this name selection, we did not have to specify anything. If the database has some other name, we have to pass it to adminer using an environment variable:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"adminer"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"environment"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" ADMINER_DEFAULT_SERVER=database_server"}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.6"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us continue with the example app that we worked with in "},{"type":"element","tagName":"a","properties":{"href":"/part-2/2-docker-networking#non-tmc-exercise-exercise-24"},"children":[{"type":"text","value":"Exercise 2.4"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now you should add database to example backend."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Use a Postgres database to save messages. For now there is no need to configure a volume since the official postgres image sets a default volume for us. Use the Postgres image documentation to your advantage when configuring: "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/postgres/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/_/postgres/"}]},{"type":"text","value":". Especially part "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Environment Variables"}]},{"type":"text","value":" is a valuable one."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The backend "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/material-applications/tree/main/example-backend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"README"}]},{"type":"text","value":" should have all the information needed to\nconnect."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is again a button (and a form!) in the frontend that you can use to ensure your configuration is done right."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TIP: When configuring the database, you might need to destroy the automatically created volumes. Use command "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume prune"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume ls"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume rm"}]},{"type":"text","value":" to remove unused volumes when testing. Make sure to remove containers that depend on them beforehand."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"restart: unless-stopped"}]},{"type":"text","value":" can help if the Postgres takes a while to get ready"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 713px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 40.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQoz4VRv4vTcBR/9dSjNzjrICieSxUHDxT18AaH+wMEwUlBHATxx3BrcRB6FcUOTi1yaxVpK+3QIZQ2lJZeqaFp06bpt01ImjZJk29yTclmv/ItDm6+5T0+fN77fHgfiMfj2wCwwbLsXqPReJTJZC4TQkBV1fJkMiGKohBVVYlhGB2KVyoV4Hn+vCzLd2az2e1er7dDcc/zDmzb/gnJZJIe3Eyn0xcFQXjdbDb3KEGSpANZlr/3+/0jhNA3RVHeEULCuq7DaDR64TgOwRgT27Z/p1KpC6PR6FiWZULVbkSj0XOtVuuhKIpPB4PB83w+f3M8Hh+6rvsLY1z2ff9Y07SvDMM84Xn+Lcdxr+bz+QfHcd4ghJ5RA51O54EgCC+h3W6DKIohy7K2MMabGOMtSrAs6whjfGLbtuJ53onjOOlcLheWJCk5GAzeAwAghPYXi8UPjPEhISSEEALgOO5UoVAATdNgOp3CfD6HUqkEu7u7p2Ox2Fld188AQDibzV5vt9tXqRhdpN113S9BEJAgCFxZlrcxxgC+768Jy+USgiCA1WoFLMtCNBqFYrEIiURivVyr1a5JkvS4Xq/fQwjtqKoaprhpmvuapt2iM3UJ/xbDMFCtVtdJUpetVgt6vd5Gt9ulId31PI/QMGgvl8v36RHDMHjDMFg6/7cikQgMh8OQKIr011dM0/xsmuZH0zQ/MQxzCQBCkiSpCKHmX4fwBz1pnAeDGkEhAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/f8422e87ea942e4462539c60b6779838/a0b58/back-front-redis-and-database.webp 230w","/static/f8422e87ea942e4462539c60b6779838/bc10c/back-front-redis-and-database.webp 460w","/static/f8422e87ea942e4462539c60b6779838/69b3e/back-front-redis-and-database.webp 713w"],"sizes":"(max-width: 713px) 100vw, 713px","type":"image/webp"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/f8422e87ea942e4462539c60b6779838/81c8e/back-front-redis-and-database.png 230w","/static/f8422e87ea942e4462539c60b6779838/08a84/back-front-redis-and-database.png 460w","/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png 713w"],"sizes":"(max-width: 713px) 100vw, 713px","type":"image/png"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png","alt":"back front redis and database","title":"back front redis and database","loading":"lazy","decoding":"async","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.7"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Postgres image uses a volume by default. Define manually a volume for the database in a convenient location such as in "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"./database"}]},{"type":"text","value":" so tyo should use now a "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/storage/bind-mounts/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"bind mount"}]},{"type":"text","value":". The image "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-library/docs/blob/master/postgres/README.md#where-to-store-data","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" may help you with the task."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After you have configured the bind mount volume:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Save a few messages through the frontend"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose down"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose up"}]},{"type":"text","value":" and see that the messages are available after refreshing browser"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose down"}]},{"type":"text","value":" and delete the volume folder manually"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose up"}]},{"type":"text","value":" and the data should be gone"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TIP: To save you the trouble of testing all of those steps, just look into the folder before trying the steps. If\nit's empty after "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose up"}]},{"type":"text","value":" then something is wrong."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The benefit of a bind mount is that since you now exactly where the data is in your file system, it is easy to create backups. If Docker managed volumes are used, the location of the data in the file system can not be controlled and that makes backups a bit less trivial..."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.8"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Add "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/_/nginx","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Nginx"}]},{"type":"text","value":" to example to work as a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Reverse_proxy","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"reverse proxy"}]},{"type":"text","value":" in front of the example app fronend and backend. According to Wikipedia"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"A reverse proxy is a type of proxy server that retrieves resources on behalf of a client from one or more servers. These resources are then returned to the client, appearing as if they originated from the reverse proxy server itself."}]}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 646px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 51.30434782608696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVQoz2WS547DQAiE/f5P6KLIP1zj3hNXom9P5NZ3SAjwLsMwa6eqKhnHUYh930uWZbdaz8mLopAoiiQIAvF9X8IwlKZpRO26LnFoOI5D1nWV8zxN8zAMMs+zASHu+27OyQEoy9KAt20rXdfJtm0GDHO4pAX2fr9NEwB/bVkW4wBopH+aJnm9Xj+ANl0FhLVeUIMlrOq6/kY8SRJ5PB6/gADZDFmXNQDmEmujG9oqcxxplCnfkevLUAGJgKFNnucmsg4RhqwH+PP5NLXdRw3oDRCjiamwQHxcpxNVLx0AAWpy/KahPRFAtKRBH4gVAbKNMwgokX8r6wMgOHqyLhqRx3EsaZqa38y+T60SOPY0+wIArAdDch7JdV3xPO+2kS0Xj/IBAEUIhg7Pvo8AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/d9c4468d5acf0246dbba4e71c2ee46ef/a0b58/back-front-redis-database-and-nginx.webp 230w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/bc10c/back-front-redis-database-and-nginx.webp 460w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/8c2f2/back-front-redis-database-and-nginx.webp 646w"],"sizes":"(max-width: 646px) 100vw, 646px","type":"image/webp"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/d9c4468d5acf0246dbba4e71c2ee46ef/81c8e/back-front-redis-database-and-nginx.png 230w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/08a84/back-front-redis-database-and-nginx.png 460w","/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png 646w"],"sizes":"(max-width: 646px) 100vw, 646px","type":"image/png"},"children":[]},{"type":"text","value":"\n          "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png","alt":"back front redis database and nginx","title":"back front redis database and nginx","loading":"lazy","decoding":"async","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So in our case, the reverse proxy will be the single point of entry to our application, and the final goal will be to set both the React frontend and the Express backend behind the reverse proxy."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The idea is that broser makes "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"all"}]},{"type":"text","value":" requests to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://localhost","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost"}]}]},{"type":"text","value":". If the request has a url prefix "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://localhost/api","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost/api"}]}]},{"type":"text","value":", Nginx should forward the request to the backend container. All the other requests are directed the frontend container."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So, at the end you should see that the frontend is accessible simply by going to "},{"type":"element","tagName":"a","properties":{"href":"http://localhost","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost"}]},{"type":"text","value":". All buttons, except the one labelled "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Exercise 2.8"}]},{"type":"text","value":" may have stopped working, do not worry about them, we shall fix that later."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following file should be set to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"/etc/nginx/nginx.conf"}]},{"type":"text","value":" inside the nginx container. You can use a file bind mount where the contents of the file is the following:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"events "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" worker_connections "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1024"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\nhttp "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  server "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    listen "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n\n    location / "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      proxy_pass _frontend-connection-url_"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# configure here where requests to http://localhost/api/..."}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# are forwarded"}]},{"type":"text","value":"\n    location /api/ "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n      proxy_set_header Host "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$host"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n      proxy_pass _backend-connection-url_"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nginx, backend and frontend should be connected in the same network. See the image above for how the services are connected. You find "},{"type":"element","tagName":"a","properties":{"href":"https://www.nginx.com/resources/wiki/start/topics/examples/full/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Nginx-documentation"}]},{"type":"text","value":" helpful, but remember, the configuration you need is pretty straight forward, if you end up doing complex things, you are most likely doing something wrong."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If and when your app \"does not work\", remember to have a look in log, it can be pretty helpful in pinpointing errors:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"2_7-proxy-1  "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\n2_7-proxy-1  "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" /docker-entrypoint.sh: Configuration complete"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":";"}]},{"type":"text","value":" ready "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" start up\n2_7-proxy-1  "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2023"}]},{"type":"text","value":"/03/05 09:24:51 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"emerg"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"#1: invalid URL prefix in /etc/nginx/nginx.conf:8"}]},{"type":"text","value":"\n2_7-proxy-1 exited with code "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]},{"type":"element","tagName":"text-box","properties":{"name":"Tips for making sure the backend connection works","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Try using your browser to access "},{"type":"element","tagName":"a","properties":{"href":"http://localhost/api/ping","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost/api/ping"}]},{"type":"text","value":" and see if it answers pong"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It might be Nginx configuration problem. Ensure there is a trailing / on the backend url as specified under the location /api/ context in the nginx.conf."}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.9"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Most of the buttons may have stopped working in the example application. Make sure that every button for exercises works."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Remember to take a peek into the browsers developer consoles again like we did back "},{"type":"element","tagName":"a","properties":{"href":"/part-1/6-docker-hub"},"children":[{"type":"text","value":"part 1"}]},{"type":"text","value":", remember also "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/material-applications/tree/main/example-frontend#exercise-114---to-connect-to-backend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"this"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/material-applications/tree/main/example-backend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"this"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The buttons of Nginx exercise and the first button behave differently but you want them to match."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you had to do any changes explain what you did and where."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml and both Dockerfiles."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.10"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we have the reverse proxy up and running! All the communication to our app should be done through the reverse proxy and direct access (eg. accessing the backend with a GET to "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:8080/ping","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:8080/ping"}]},{"type":"text","value":" ) should be prevented."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Use a port scanner, eg "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/r/networkstatic/nmap","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/r/networkstatic/nmap"}]},{"type":"text","value":" to ensure that there are no extra ports open in the host."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It might be enough to just run"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ docker run -it --rm --network host networkstatic/nmap localhost"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you have an M1/M2 Mac, you might need to build the image yourself."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The result looks like the following (I used a self-built image):"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"docker"}]},{"type":"text","value":" run "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"-it"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"--rm"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","parameter","variable"]},"children":[{"type":"text","value":"--network"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"host"}]},{"type":"text","value":" nmap localhost\nStarting Nmap "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"7.93"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":" https://nmap.org "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" at "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2023"}]},{"type":"text","value":"-03-05 "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"12"}]},{"type":"text","value":":28 UTC\nNmap scan report "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" localhost "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"127.0"}]},{"type":"text","value":".0.1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\nHost is up "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":".0000040s latency"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":".\nOther addresses "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" localhost "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"not scanned"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":": ::1\nNot shown: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"996"}]},{"type":"text","value":" closed tcp ports "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"reset"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\nPORT     STATE    SERVICE\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"/tcp   filtered http\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"111"}]},{"type":"text","value":"/tcp  "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"open"}]},{"type":"text","value":"     rpcbind\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5000"}]},{"type":"text","value":"/tcp filtered commplex-link\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8080"}]},{"type":"text","value":"/tcp filtered http-proxy\n\nNmap done: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" IP address "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"host"}]},{"type":"text","value":" up"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" scanned "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.28"}]},{"type":"text","value":" seconds"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As we see, there are two suspicious open ports: 5000 and 8080. So it is obvious that the frontend and backend are still directly accessible in the host network. This should be fixed!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You are done when the port scan report looks something like this:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"Starting Nmap "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"7.93"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":" https://nmap.org "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" at "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2023"}]},{"type":"text","value":"-03-05 "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"12"}]},{"type":"text","value":":39 UTC\nNmap scan report "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" localhost "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"127.0"}]},{"type":"text","value":".0.1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\nHost is up "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":".0000040s latency"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":".\nOther addresses "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" localhost "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"not scanned"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":": ::1\nNot shown: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"998"}]},{"type":"text","value":" closed tcp ports "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"reset"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\nPORT    STATE    SERVICE\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"/tcp  filtered http\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"111"}]},{"type":"text","value":"/tcp "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"open"}]},{"type":"text","value":"     rpcbind\n\nNmap done: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" IP address "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"host"}]},{"type":"text","value":" up"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" scanned "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"in"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.28"}]},{"type":"text","value":" seconds"}]}]}]},{"type":"element","tagName":"text-box","properties":{"name":"Publishing ports to host network","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is an important lesson about Docker networking and ports to be learned in this exercise."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we do a "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/desktop/networking/#port-mapping","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"port mapping"}]},{"type":"text","value":", in "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker run -p 8001:80 ..."}]},{"type":"text","value":" or in Docker Compose file, we are "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/config/containers/container-networking/#published-ports","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"publishing"}]},{"type":"text","value":" a container port to the host network to be accessible in localhost."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The container port is there within the Docker network accessible by the other containers who are in the same network even if we do not publish anything. So publishing the ports is only for exposing ports outside the Docker network. If no direct access outside the network is not needed, then we just do not publish anything."}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.11"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We are finally done with the example app and it is time to move on!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Configure a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Machine_learning","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"machine learning"}]},{"type":"text","value":" project with Docker compose."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Look into machine learning project created with Python and React and split into three parts:\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/ml-kurkkumopo-frontend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"frontend"}]},{"type":"text","value":",\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/ml-kurkkumopo-backend","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"backend"}]},{"type":"text","value":" and\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/docker-hy/ml-kurkkumopo-training","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"training"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that the training requires 2 volumes and backend should share volume "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/src/model"}]},{"type":"text","value":" with training."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The frontend will display on "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:3000"}]},{"type":"text","value":" and the application will tell if the subject of an image looks more\nlike a cucumber or a moped."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the docker-compose.yml"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This exercise is known to have broken for some attendees based on CPU. The error looks something like \"Illegal instruction (core dumped)\". Try downgrading / upgrading the tensorflow found in requirements.txt or join the Discord channel and message with Jakousa#1337."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that the generated model is a toy and will not produce good results."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It will take SEVERAL minutes to build the docker images, download training pictures and train the classifying model."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This exercise was created by "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/sasumaki","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Sasu Mäkinen"}]}]}]}]},"html":"<div><p>Next we're going to set up the project management application <a href=\"https://www.redmine.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Redmine</a>, a PostgreSQL database and <a href=\"https://www.adminer.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Adminer</a>, a graphical interface for database administration.</p><p>All of above have official Docker images available as we can see from <a href=\"https://hub.docker.com/_/redmine\" target=\"_blank\" rel=\"noopener noreferrer\">Redmine</a>, <a href=\"https://hub.docker.com/_/postgres\" target=\"_blank\" rel=\"noopener noreferrer\">Postgres</a> and <a href=\"https://hub.docker.com/_/adminer\" target=\"_blank\" rel=\"noopener noreferrer\">Adminer</a> respectively. The officiality of the containers is not that important, just that we can expect that it will have some support. We could also, for example, setup Wordpress or a MediaWiki inside containers in the same manner if you're interested in running existing applications inside Docker. You could even set up a application monitoring tool such as <a href=\"https://hub.docker.com/_/sentry/\" target=\"_blank\" rel=\"noopener noreferrer\">Sentry</a>.</p><p>In <a href=\"https://hub.docker.com/_/redmine\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/_/redmine</a> there is a list of different tagged versions:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6cf55bd406223486a26ace02123a93c5/01a87/redmine.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfElEQVQoz22Q2Y7bMAxF/f9f1s4Ek8VJO+kCBNltyRIlUkusrVCCJn4Ygg8HFK7uJZu394/5YvWxWLWbn4tl+zabb358zpft9tff+1O7WK0Px1O73rzP5qt287n9vWzXwyBKKc2377Pd/lBKyTmXUlJKD3hOnjWdP7jhfCCkySj/x1zu/TWXuzilfBX6KhQDNM4zwB4QyPaAvcSz0No4BngRugfUxl2EvgjlbmMV55wFGgZo/e2VKb/8Y0q1Y5pCSnfnMcR9L49M7jrRCb3rxJ8zvwp1ZLA9sl7qDlAZB2QHTVeJDIisl2hyztWZaxLaaGPJeq4e7KQ2Eo0iG2J1CjGNIcaYpidsQgiAhpxXZI3z5PygTSexk/UEXJkjV88rXCWGib6JMSqykiyDmsr5G5DtJFWxrR9dhAay5auqYq6Qgb4MGtBwwPMANbBxnUC0TpEV2vRAAus65PxEnNKJqxOHHnBQtGdwYABkY8p+jCHWbW8h+jGMd47pFfsfFEZ0XG2SDuIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/6cf55bd406223486a26ace02123a93c5/a0b58/redmine.webp 230w,\n/static/6cf55bd406223486a26ace02123a93c5/bc10c/redmine.webp 460w,\n/static/6cf55bd406223486a26ace02123a93c5/966d8/redmine.webp 920w,\n/static/6cf55bd406223486a26ace02123a93c5/6f638/redmine.webp 1288w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n          <source srcset=\"/static/6cf55bd406223486a26ace02123a93c5/81c8e/redmine.png 230w,\n/static/6cf55bd406223486a26ace02123a93c5/08a84/redmine.png 460w,\n/static/6cf55bd406223486a26ace02123a93c5/c0255/redmine.png 920w,\n/static/6cf55bd406223486a26ace02123a93c5/01a87/redmine.png 1288w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/6cf55bd406223486a26ace02123a93c5/c0255/redmine.png\" alt=\"redmine\" title=\"redmine\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span><p>We can most likely use any of the available images.</p><p>From section <em>Environment Variables</em> we can see that all versions can use <code class=\"language-text\">REDMINE_DB_POSTGRES</code> environment variable to set up a Postgres database. So before moving forward, let's setup Postgres for us.</p><p>In <a href=\"https://hub.docker.com/_/postgres\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/_/postgres</a> there's a sample compose file under \"via Docker Stack deploy or Docker Compose\" - Let's strip that down to</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>13.2<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">POSTGRES_PASSWORD</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> db_redmine</code></pre></div><p>Note:</p><ul>\n<li><code class=\"language-text\">restart: always</code> was changed to <code class=\"language-text\">unless-stopped</code> that will keep the container running unless we explicitely stop it. With <code class=\"language-text\">always</code> the stopped container is started after reboot for example, see <a href=\"https://docs.docker.com/config/containers/start-containers-automatically/\" target=\"_blank\" rel=\"noopener noreferrer\">here</a> for more.</li>\n</ul><p>Under the section <a href=\"https://github.com/docker-library/docs/blob/master/postgres/README.md#where-to-store-data\" target=\"_blank\" rel=\"noopener noreferrer\">Where to store data</a> we can see that the <code class=\"language-text\">/var/lib/postgresql/data</code> should be mounted separately to preserve the data.</p><p>There are two options. We could use a bind mount like previously and mount a easy-to-locate directory for storing the data. Let us now use the other opiton, a <a href=\"https://docs.docker.com/storage/volumes/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker managed volume</a>.</p><p>Let's run the Docker Compose file without setting anything new:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker compose up\n\n  Creating network &quot;redmine_default&quot; with the default driver\n  Creating db_redmine ... done\n  Attaching to db_redmine\n  db_redmine | The files belonging to this database system will be owned by user &quot;postgres&quot;.\n  ...\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv4 address &quot;0.0.0.0&quot;, port 5432\n  db_redmine | 2019-03-03 10:27:22.975 UTC [1] LOG:  listening on IPv6 address &quot;::&quot;, port 5432\n  db_redmine | 2019-03-03 10:27:22.979 UTC [1] LOG:  listening on Unix socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;\n  db_redmine | 2019-03-03 10:27:22.995 UTC [50] LOG:  database system was shut down at 2019-03-03 10:27:22 UTC\n  db_redmine | 2019-03-03 10:27:23.002 UTC [1] LOG:  database system is ready to accept connections</code></pre></div><p>The image initializes the data files in the first start. Let's terminate the container with ^C. Compose uses the current directory as a prefix for container and volume names so that different projects don't clash (The prefix can be overridden with <code class=\"language-text\">COMPOSE_PROJECT_NAME</code> environment variable if needed).</p><p>Let's <strong>inspect</strong> if there was a volume created with <code class=\"language-text\">docker container inspect db_redmine | grep -A 5 Mounts</code></p><div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"Mounts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"volume\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df/_data\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Destination\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/postgresql/data\"</span><span class=\"token punctuation\">,</span></code></pre></div><p>An indeed there is one! So despite we did not configure anything the</p><p>Now if we check out <code class=\"language-text\">docker volume ls</code> we can see that a volume with name \"794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df\" exists.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               794c9d8db6b5e643865c8364bf3b807b4165291f02508404ff3309b8ffde01df</code></pre></div><p>There may be more volumes on your machine. If you want to get rid of them you can use <code class=\"language-text\">docker volume prune</code>. Let's put the whole \"application\" down now with <code class=\"language-text\">docker compose down</code>.</p><p>Instead of the randomly named volume we better define one explicitly.\nLet us change the definition as follows:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>13.2<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">POSTGRES_PASSWORD</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> db_redmine\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> database<span class=\"token punctuation\">:</span>/var/lib/postgresql/data\n\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  database<span class=\"token punctuation\">:</span></code></pre></div><p>Now let us check what it looks like:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker volume ls\n  DRIVER              VOLUME NAME\n  local               redmine_database\n\n$ docker container inspect db_redmine | grep -A 5 Mounts\n&quot;Mounts&quot;: [\n    {\n        &quot;Type&quot;: &quot;volume&quot;,\n        &quot;Name&quot;: &quot;redmine_database&quot;,\n        &quot;Source&quot;: &quot;/var/lib/docker/volumes/ongoing_redminedata/_data&quot;,\n        &quot;Destination&quot;: &quot;/var/lib/postgresql/data&quot;,</code></pre></div><p>Ok, looks a bit more human readable! Now when the Postgres is running, is is time to add <a href=\"https://hub.docker.com/_/redmine\" target=\"_blank\" rel=\"noopener noreferrer\">Redmine</a>.</p><p>The container seems to require just two environment variables.</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">redmine</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redmine<span class=\"token punctuation\">:</span>4.1<span class=\"token punctuation\">-</span>alpine\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> REDMINE_DB_POSTGRES=db\n    <span class=\"token punctuation\">-</span> REDMINE_DB_PASSWORD=example\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> 9999<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n  <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> db</code></pre></div><p>Notice the <a href=\"https://docs.docker.com/compose/compose-file/compose-file-v3/#depends_on\" target=\"_blank\" rel=\"noopener noreferrer\">depends_on</a> declaration. This makes sure that the <code class=\"language-text\">db</code> service is started first. <code class=\"language-text\">depends_on</code> does not guarantee that the database is up, just that it is started first. The Postgres server is accessible with DNS name \"db\" from the Redmine service as discussed in the section <a href=\"/part-2/2-docker-networking\">Docker networking</a>.</p><p>Now when you run <code class=\"language-text\">docker compose up</code> you will see a bunch of database migrations running first.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">  redmine_1  | I, [2019-03-03T10:59:20.956936 #25]  INFO -- : Migrating to Setup (1)\n  redmine_1  | == 1 Setup: migrating =========================================================\n  ...\n  redmine_1  | [2019-03-03 11:01:10] INFO  ruby 2.6.1 (2019-01-30) [x86_64-linux]\n  redmine_1  | [2019-03-03 11:01:10] INFO  WEBrick::HTTPServer#start: pid=1 port=3000</code></pre></div><p>As the <a href=\"https://hub.docker.com/_/redmine\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a> mentions, the image creates files to <code class=\"language-text\">/usr/src/redmine/files</code> and those are better to be persisted. The Dockerfile has this <a href=\"https://github.com/docker-library/redmine/blob/cea16044e97567c28802fc8cc06f6cd036c49a5c/4.0/Dockerfile#L155\" target=\"_blank\" rel=\"noopener noreferrer\">line</a> where it declares that a volume should be created. Again Docker will create the volume, but it will be handled as an anonymous volume that is not managed by the Docker Compose, so it's better to create it explicitly.</p><p>With that in mind, our configuration changes to this:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.8\"</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>13.2<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">POSTGRES_PASSWORD</span><span class=\"token punctuation\">:</span> example\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> db_redmine\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> database<span class=\"token punctuation\">:</span>/var/lib/postgresql/data\n  <span class=\"token key atrule\">redmine</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redmine<span class=\"token punctuation\">:</span>4.1<span class=\"token punctuation\">-</span>alpine\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> REDMINE_DB_POSTGRES=db\n      <span class=\"token punctuation\">-</span> REDMINE_DB_PASSWORD=example\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 9999<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> files<span class=\"token punctuation\">:</span>/usr/src/redmine/files\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> db\n\n<span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">database</span><span class=\"token punctuation\">:</span>\n  files<span class=\"token punctuation\">:</span></code></pre></div><p>Now we can use the application with our browser through <a href=\"http://localhost:9999\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:9999</a>. After some changes inside the application we can inspect the changes that happened in the image and check that no extra meaningful files got written to the container:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker container diff $(docker compose ps -q redmine)\n  C /usr/src/redmine/config/environment.rb\n  ...\n  C /usr/src/redmine/tmp/pdf</code></pre></div><p>Probably not.</p><p>We could  use psql to interact with the Postgres database by running  <code class=\"language-text\">docker container exec -it db_redmine psql -U postgres</code>. (The command <strong>exec</strong>utes psql -U postgres inside the container) The same method can be used to create backups with pg_dump: <code class=\"language-text\">docker container exec db_redmine pg_dump -U postgres > redmine.dump</code>.</p><p>Rather than using the archaic command line interface to access Postgres, let us now set up the database adminer to the application.</p><p>After a look at the <a href=\"https://hub.docker.com/_/adminer\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a>,\nthe setup is straightforward:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">adminer</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> adminer<span class=\"token punctuation\">:</span><span class=\"token number\">4</span>\n  <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n  <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ADMINER_DESIGN=galkaev\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> 8083<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></code></pre></div><p>Now when we run the application we can access adminer from <a href=\"http://localhost:8083\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8083</a>:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9af398f91fdb8474c8c7046ab32be620/7e318/adminer.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.69565217391304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVQY04XOzU6DQBSG4YEZChZCgVGBGUiVRhe1Ir8ZIm69CG/B+9Jqy0yJuqkre2emmibSoD452zffAR+bzXr9Ltp22XCxal9e3xoueNtyseJCcCGa7i2b5uFxPn96XiyWIN2J4zjPc9/zAQRS6AAogX/VdX39pSgKxlgYBLICnSOsG4aqKMZgAGVZ6urE331ZlowxSohumUmWRlF0OLIsTfvrgewHVlWUkOHIjJM0iibE9Yjr67pu/ALkO9t4u0wPTP1yNhmH7jHGZ+MT27Ydx8F99uIqoARp1uzmnp7fZmniuS5CCELY//bechhQIA9Pr+4cWl1MpxhjVVURQr3xJ3HUTc8Zt73yAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/9af398f91fdb8474c8c7046ab32be620/a0b58/adminer.webp 230w,\n/static/9af398f91fdb8474c8c7046ab32be620/bc10c/adminer.webp 460w,\n/static/9af398f91fdb8474c8c7046ab32be620/966d8/adminer.webp 920w,\n/static/9af398f91fdb8474c8c7046ab32be620/445df/adminer.webp 1380w,\n/static/9af398f91fdb8474c8c7046ab32be620/78de1/adminer.webp 1840w,\n/static/9af398f91fdb8474c8c7046ab32be620/629a2/adminer.webp 1892w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n          <source srcset=\"/static/9af398f91fdb8474c8c7046ab32be620/81c8e/adminer.png 230w,\n/static/9af398f91fdb8474c8c7046ab32be620/08a84/adminer.png 460w,\n/static/9af398f91fdb8474c8c7046ab32be620/c0255/adminer.png 920w,\n/static/9af398f91fdb8474c8c7046ab32be620/b1001/adminer.png 1380w,\n/static/9af398f91fdb8474c8c7046ab32be620/161ec/adminer.png 1840w,\n/static/9af398f91fdb8474c8c7046ab32be620/7e318/adminer.png 1892w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/9af398f91fdb8474c8c7046ab32be620/c0255/adminer.png\" alt=\"adminer\" title=\"adminer\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span><p>Setting up the adminer is straightforward since it will be able to access the database through Docker network. You may wonder how adminer finds the Postgres database container? We provide this information to Redmine using an environment variable:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">redmine</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> REDMINE_DB_POSTGRES=db</code></pre></div><p>Adminer actually assumes that the database has DN Sname  <em>db</em> so with this name selection, we did not have to specify anything. If the database has some other name, we have to pass it to adminer using an environment variable:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">adminer</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ADMINER_DEFAULT_SERVER=database_server</code></pre></div><exercise name=\"Exercise 2.6\"><p>Let us continue with the example app that we worked with in <a href=\"/part-2/2-docker-networking#non-tmc-exercise-exercise-24\">Exercise 2.4</a>.</p><p>Now you should add database to example backend.</p><p>Use a Postgres database to save messages. For now there is no need to configure a volume since the official postgres image sets a default volume for us. Use the Postgres image documentation to your advantage when configuring: <a href=\"https://hub.docker.com/_/postgres/\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/_/postgres/</a>. Especially part <em>Environment Variables</em> is a valuable one.</p><p>The backend <a href=\"https://github.com/docker-hy/material-applications/tree/main/example-backend\" target=\"_blank\" rel=\"noopener noreferrer\">README</a> should have all the information needed to\nconnect.</p><p>There is again a button (and a form!) in the frontend that you can use to ensure your configuration is done right.</p><p>Submit the docker-compose.yml</p><ul>\n<li>\n<p>TIP: When configuring the database, you might need to destroy the automatically created volumes. Use command <code class=\"language-text\">docker volume prune</code>, <code class=\"language-text\">docker volume ls</code> and <code class=\"language-text\">docker volume rm</code> to remove unused volumes when testing. Make sure to remove containers that depend on them beforehand.</p>\n</li>\n<li>\n<p><code class=\"language-text\">restart: unless-stopped</code> can help if the Postgres takes a while to get ready</p>\n</li>\n</ul><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 713px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQoz4VRv4vTcBR/9dSjNzjrICieSxUHDxT18AaH+wMEwUlBHATxx3BrcRB6FcUOTi1yaxVpK+3QIZQ2lJZeqaFp06bpt01ImjZJk29yTclmv/ItDm6+5T0+fN77fHgfiMfj2wCwwbLsXqPReJTJZC4TQkBV1fJkMiGKohBVVYlhGB2KVyoV4Hn+vCzLd2az2e1er7dDcc/zDmzb/gnJZJIe3Eyn0xcFQXjdbDb3KEGSpANZlr/3+/0jhNA3RVHeEULCuq7DaDR64TgOwRgT27Z/p1KpC6PR6FiWZULVbkSj0XOtVuuhKIpPB4PB83w+f3M8Hh+6rvsLY1z2ff9Y07SvDMM84Xn+Lcdxr+bz+QfHcd4ghJ5RA51O54EgCC+h3W6DKIohy7K2MMabGOMtSrAs6whjfGLbtuJ53onjOOlcLheWJCk5GAzeAwAghPYXi8UPjPEhISSEEALgOO5UoVAATdNgOp3CfD6HUqkEu7u7p2Ox2Fld188AQDibzV5vt9tXqRhdpN113S9BEJAgCFxZlrcxxgC+768Jy+USgiCA1WoFLMtCNBqFYrEIiURivVyr1a5JkvS4Xq/fQwjtqKoaprhpmvuapt2iM3UJ/xbDMFCtVtdJUpetVgt6vd5Gt9ulId31PI/QMGgvl8v36RHDMHjDMFg6/7cikQgMh8OQKIr011dM0/xsmuZH0zQ/MQxzCQBCkiSpCKHmX4fwBz1pnAeDGkEhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/f8422e87ea942e4462539c60b6779838/a0b58/back-front-redis-and-database.webp 230w,\n/static/f8422e87ea942e4462539c60b6779838/bc10c/back-front-redis-and-database.webp 460w,\n/static/f8422e87ea942e4462539c60b6779838/69b3e/back-front-redis-and-database.webp 713w\" sizes=\"(max-width: 713px) 100vw, 713px\" type=\"image/webp\">\n          <source srcset=\"/static/f8422e87ea942e4462539c60b6779838/81c8e/back-front-redis-and-database.png 230w,\n/static/f8422e87ea942e4462539c60b6779838/08a84/back-front-redis-and-database.png 460w,\n/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png 713w\" sizes=\"(max-width: 713px) 100vw, 713px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/f8422e87ea942e4462539c60b6779838/01267/back-front-redis-and-database.png\" alt=\"back front redis and database\" title=\"back front redis and database\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span></exercise><exercise name=\"Exercise 2.7\"><p>Postgres image uses a volume by default. Define manually a volume for the database in a convenient location such as in <code class=\"language-text\">./database</code> so tyo should use now a <a href=\"https://docs.docker.com/storage/bind-mounts/\" target=\"_blank\" rel=\"noopener noreferrer\">bind mount</a>. The image <a href=\"https://github.com/docker-library/docs/blob/master/postgres/README.md#where-to-store-data\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a> may help you with the task.</p><p>After you have configured the bind mount volume:</p><ul>\n<li>Save a few messages through the frontend</li>\n<li>Run <code class=\"language-text\">docker compose down</code></li>\n<li>Run <code class=\"language-text\">docker compose up</code> and see that the messages are available after refreshing browser</li>\n<li>Run <code class=\"language-text\">docker compose down</code> and delete the volume folder manually</li>\n<li>Run <code class=\"language-text\">docker compose up</code> and the data should be gone</li>\n</ul><blockquote>\n<p>TIP: To save you the trouble of testing all of those steps, just look into the folder before trying the steps. If\nit's empty after <code class=\"language-text\">docker compose up</code> then something is wrong.</p>\n</blockquote><p>Submit the docker-compose.yml</p><p>The benefit of a bind mount is that since you now exactly where the data is in your file system, it is easy to create backups. If Docker managed volumes are used, the location of the data in the file system can not be controlled and that makes backups a bit less trivial...</p></exercise><exercise name=\"Exercise 2.8\"><p>Add <a href=\"https://hub.docker.com/_/nginx\" target=\"_blank\" rel=\"noopener noreferrer\">Nginx</a> to example to work as a <a href=\"https://en.wikipedia.org/wiki/Reverse_proxy\" target=\"_blank\" rel=\"noopener noreferrer\">reverse proxy</a> in front of the example app fronend and backend. According to Wikipedia</p><p><em>A reverse proxy is a type of proxy server that retrieves resources on behalf of a client from one or more servers. These resources are then returned to the client, appearing as if they originated from the reverse proxy server itself.</em></p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 646px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.30434782608696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVQoz2WS547DQAiE/f5P6KLIP1zj3hNXom9P5NZ3SAjwLsMwa6eqKhnHUYh930uWZbdaz8mLopAoiiQIAvF9X8IwlKZpRO26LnFoOI5D1nWV8zxN8zAMMs+zASHu+27OyQEoy9KAt20rXdfJtm0GDHO4pAX2fr9NEwB/bVkW4wBopH+aJnm9Xj+ANl0FhLVeUIMlrOq6/kY8SRJ5PB6/gADZDFmXNQDmEmujG9oqcxxplCnfkevLUAGJgKFNnucmsg4RhqwH+PP5NLXdRw3oDRCjiamwQHxcpxNVLx0AAWpy/KahPRFAtKRBH4gVAbKNMwgokX8r6wMgOHqyLhqRx3EsaZqa38y+T60SOPY0+wIArAdDch7JdV3xPO+2kS0Xj/IBAEUIhg7Pvo8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/a0b58/back-front-redis-database-and-nginx.webp 230w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/bc10c/back-front-redis-database-and-nginx.webp 460w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/8c2f2/back-front-redis-database-and-nginx.webp 646w\" sizes=\"(max-width: 646px) 100vw, 646px\" type=\"image/webp\">\n          <source srcset=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/81c8e/back-front-redis-database-and-nginx.png 230w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/08a84/back-front-redis-database-and-nginx.png 460w,\n/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png 646w\" sizes=\"(max-width: 646px) 100vw, 646px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/d9c4468d5acf0246dbba4e71c2ee46ef/27524/back-front-redis-database-and-nginx.png\" alt=\"back front redis database and nginx\" title=\"back front redis database and nginx\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span><p>So in our case, the reverse proxy will be the single point of entry to our application, and the final goal will be to set both the React frontend and the Express backend behind the reverse proxy.</p><p>The idea is that broser makes <em>all</em> requests to <em><a href=\"http://localhost\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost</a></em>. If the request has a url prefix <em><a href=\"http://localhost/api\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost/api</a></em>, Nginx should forward the request to the backend container. All the other requests are directed the frontend container.</p><p>So, at the end you should see that the frontend is accessible simply by going to <a href=\"http://localhost\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost</a>. All buttons, except the one labelled <em>Exercise 2.8</em> may have stopped working, do not worry about them, we shall fix that later.</p><p>The following file should be set to <em>/etc/nginx/nginx.conf</em> inside the nginx container. You can use a file bind mount where the contents of the file is the following:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">events <span class=\"token punctuation\">{</span> worker_connections <span class=\"token number\">1024</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\nhttp <span class=\"token punctuation\">{</span>\n  server <span class=\"token punctuation\">{</span>\n    listen <span class=\"token number\">80</span><span class=\"token punctuation\">;</span>\n\n    location / <span class=\"token punctuation\">{</span>\n      proxy_pass _frontend-connection-url_<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># configure here where requests to http://localhost/api/...</span>\n    <span class=\"token comment\"># are forwarded</span>\n    location /api/ <span class=\"token punctuation\">{</span>\n      proxy_set_header Host <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span>\n      proxy_pass _backend-connection-url_<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div><p>Nginx, backend and frontend should be connected in the same network. See the image above for how the services are connected. You find <a href=\"https://www.nginx.com/resources/wiki/start/topics/examples/full/\" target=\"_blank\" rel=\"noopener noreferrer\">Nginx-documentation</a> helpful, but remember, the configuration you need is pretty straight forward, if you end up doing complex things, you are most likely doing something wrong.</p><p>If and when your app \"does not work\", remember to have a look in log, it can be pretty helpful in pinpointing errors:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">2_7-proxy-1  <span class=\"token operator\">|</span> /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\n2_7-proxy-1  <span class=\"token operator\">|</span> /docker-entrypoint.sh: Configuration complete<span class=\"token punctuation\">;</span> ready <span class=\"token keyword\">for</span> start up\n2_7-proxy-1  <span class=\"token operator\">|</span> <span class=\"token number\">2023</span>/03/05 09:24:51 <span class=\"token punctuation\">[</span>emerg<span class=\"token punctuation\">]</span> <span class=\"token number\">1</span><span class=\"token comment\">#1: invalid URL prefix in /etc/nginx/nginx.conf:8</span>\n2_7-proxy-1 exited with code <span class=\"token number\">1</span></code></pre></div><p>Submit the docker-compose.yml</p><text-box name=\"Tips for making sure the backend connection works\" variant=\"hint\"><p>Try using your browser to access <a href=\"http://localhost/api/ping\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost/api/ping</a> and see if it answers pong</p><p>It might be Nginx configuration problem. Ensure there is a trailing / on the backend url as specified under the location /api/ context in the nginx.conf.</p></text-box></exercise><exercise name=\"Exercise 2.9\"><p>Most of the buttons may have stopped working in the example application. Make sure that every button for exercises works.</p><p>Remember to take a peek into the browsers developer consoles again like we did back <a href=\"/part-1/6-docker-hub\">part 1</a>, remember also <a href=\"https://github.com/docker-hy/material-applications/tree/main/example-frontend#exercise-114---to-connect-to-backend\" target=\"_blank\" rel=\"noopener noreferrer\">this</a> and <a href=\"https://github.com/docker-hy/material-applications/tree/main/example-backend\" target=\"_blank\" rel=\"noopener noreferrer\">this</a>.</p><p>The buttons of Nginx exercise and the first button behave differently but you want them to match.</p><p>If you had to do any changes explain what you did and where.</p><p>Submit the docker-compose.yml and both Dockerfiles.</p></exercise><exercise name=\"Exercise 2.10\"><p>Now we have the reverse proxy up and running! All the communication to our app should be done through the reverse proxy and direct access (eg. accessing the backend with a GET to <a href=\"http://localhost:8080/ping\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8080/ping</a> ) should be prevented.</p><p>Use a port scanner, eg <a href=\"https://hub.docker.com/r/networkstatic/nmap\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/r/networkstatic/nmap</a> to ensure that there are no extra ports open in the host.</p><p>It might be enough to just run</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ docker run -it --rm --network host networkstatic/nmap localhost</code></pre></div><p>If you have an M1/M2 Mac, you might need to build the image yourself.</p><p>The result looks like the following (I used a self-built image):</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--rm</span> <span class=\"token parameter variable\">--network</span> <span class=\"token function\">host</span> nmap localhost\nStarting Nmap <span class=\"token number\">7.93</span> <span class=\"token punctuation\">(</span> https://nmap.org <span class=\"token punctuation\">)</span> at <span class=\"token number\">2023</span>-03-05 <span class=\"token number\">12</span>:28 UTC\nNmap scan report <span class=\"token keyword\">for</span> localhost <span class=\"token punctuation\">(</span><span class=\"token number\">127.0</span>.0.1<span class=\"token punctuation\">)</span>\nHost is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.0000040s latency<span class=\"token punctuation\">)</span>.\nOther addresses <span class=\"token keyword\">for</span> localhost <span class=\"token punctuation\">(</span>not scanned<span class=\"token punctuation\">)</span>: ::1\nNot shown: <span class=\"token number\">996</span> closed tcp ports <span class=\"token punctuation\">(</span>reset<span class=\"token punctuation\">)</span>\nPORT     STATE    SERVICE\n<span class=\"token number\">80</span>/tcp   filtered http\n<span class=\"token number\">111</span>/tcp  <span class=\"token function\">open</span>     rpcbind\n<span class=\"token number\">5000</span>/tcp filtered commplex-link\n<span class=\"token number\">8080</span>/tcp filtered http-proxy\n\nNmap done: <span class=\"token number\">1</span> IP address <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token function\">host</span> up<span class=\"token punctuation\">)</span> scanned <span class=\"token keyword\">in</span> <span class=\"token number\">1.28</span> seconds</code></pre></div><p>As we see, there are two suspicious open ports: 5000 and 8080. So it is obvious that the frontend and backend are still directly accessible in the host network. This should be fixed!</p><p>You are done when the port scan report looks something like this:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Starting Nmap <span class=\"token number\">7.93</span> <span class=\"token punctuation\">(</span> https://nmap.org <span class=\"token punctuation\">)</span> at <span class=\"token number\">2023</span>-03-05 <span class=\"token number\">12</span>:39 UTC\nNmap scan report <span class=\"token keyword\">for</span> localhost <span class=\"token punctuation\">(</span><span class=\"token number\">127.0</span>.0.1<span class=\"token punctuation\">)</span>\nHost is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.0000040s latency<span class=\"token punctuation\">)</span>.\nOther addresses <span class=\"token keyword\">for</span> localhost <span class=\"token punctuation\">(</span>not scanned<span class=\"token punctuation\">)</span>: ::1\nNot shown: <span class=\"token number\">998</span> closed tcp ports <span class=\"token punctuation\">(</span>reset<span class=\"token punctuation\">)</span>\nPORT    STATE    SERVICE\n<span class=\"token number\">80</span>/tcp  filtered http\n<span class=\"token number\">111</span>/tcp <span class=\"token function\">open</span>     rpcbind\n\nNmap done: <span class=\"token number\">1</span> IP address <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token function\">host</span> up<span class=\"token punctuation\">)</span> scanned <span class=\"token keyword\">in</span> <span class=\"token number\">1.28</span> seconds</code></pre></div><text-box name=\"Publishing ports to host network\" variant=\"hint\"><p>There is an important lesson about Docker networking and ports to be learned in this exercise.</p><p>When we do a <a href=\"https://docs.docker.com/desktop/networking/#port-mapping\" target=\"_blank\" rel=\"noopener noreferrer\">port mapping</a>, in <code class=\"language-text\">docker run -p 8001:80 ...</code> or in Docker Compose file, we are <a href=\"https://docs.docker.com/config/containers/container-networking/#published-ports\" target=\"_blank\" rel=\"noopener noreferrer\">publishing</a> a container port to the host network to be accessible in localhost.</p><p>The container port is there within the Docker network accessible by the other containers who are in the same network even if we do not publish anything. So publishing the ports is only for exposing ports outside the Docker network. If no direct access outside the network is not needed, then we just do not publish anything.</p></text-box></exercise><exercise name=\"Exercise 2.11\"><p>We are finally done with the example app and it is time to move on!</p><p>Configure a <a href=\"https://en.wikipedia.org/wiki/Machine_learning\" target=\"_blank\" rel=\"noopener noreferrer\">machine learning</a> project with Docker compose.</p><p>Look into machine learning project created with Python and React and split into three parts:\n<a href=\"https://github.com/docker-hy/ml-kurkkumopo-frontend\" target=\"_blank\" rel=\"noopener noreferrer\">frontend</a>,\n<a href=\"https://github.com/docker-hy/ml-kurkkumopo-backend\" target=\"_blank\" rel=\"noopener noreferrer\">backend</a> and\n<a href=\"https://github.com/docker-hy/ml-kurkkumopo-training\" target=\"_blank\" rel=\"noopener noreferrer\">training</a></p><p>Note that the training requires 2 volumes and backend should share volume <code class=\"language-text\">/src/model</code> with training.</p><p>The frontend will display on <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a> and the application will tell if the subject of an image looks more\nlike a cucumber or a moped.</p><p>Submit the docker-compose.yml</p><ul>\n<li>\n<p>This exercise is known to have broken for some attendees based on CPU. The error looks something like \"Illegal instruction (core dumped)\". Try downgrading / upgrading the tensorflow found in requirements.txt or join the Discord channel and message with Jakousa#1337.</p>\n</li>\n<li>\n<p>Note that the generated model is a toy and will not produce good results.</p>\n</li>\n<li>\n<p>It will take SEVERAL minutes to build the docker images, download training pictures and train the classifying model.</p>\n</li>\n</ul><p>This exercise was created by <a href=\"https://github.com/sasumaki\" target=\"_blank\" rel=\"noopener noreferrer\">Sasu Mäkinen</a></p></exercise></div>","frontmatter":{"path":"/part-2/3-volumes-in-action","title":"Volumes in action"},"fileAbsolutePath":"/home/runner/work/docker-hy.github.io/docker-hy.github.io/data/part-2/section-3.md"},"allPages":{"edges":[{"node":{"id":"4352ae37-1cc5-5973-956b-aa3c8cc1a438","frontmatter":{"path":"/faq","title":"Frequently asked questions"}}},{"node":{"id":"e1238e90-e69f-5b89-ae7f-7a3890359b73","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"cc180895-565d-5264-95c9-d15f066c38c3","frontmatter":{"path":"/","title":"About this course"}}},{"node":{"id":"0601dd7a-78da-53bb-9402-15fadc681ddc","frontmatter":{"path":"/links","title":"Links"}}},{"node":{"id":"3cb91679-41d9-585e-8746-8d7f0fbc121a","frontmatter":{"path":"/getting-started","title":"Getting started"}}},{"node":{"id":"6c9405c1-39a6-56b2-934e-33850f881070","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"c5438964-0c78-52f9-b28f-f73711d88666","frontmatter":{"path":"/part-1/1-getting-started","title":"Definitions and basic concepts"}}},{"node":{"id":"a8076827-affa-555a-b777-dba87c8e257f","frontmatter":{"path":"/part-1/2-running-and-stopping","title":"Running and stopping containers"}}},{"node":{"id":"d1d17462-978a-5516-8207-0fff56d3d301","frontmatter":{"path":"/part-1/3-in-depth-dive-to-images","title":"In-depth dive to images"}}},{"node":{"id":"b86409c3-2663-57ce-9a34-5ba818f8c6f7","frontmatter":{"path":"/part-1/4-defining-start-conditions","title":"Defining start conditions for the container"}}},{"node":{"id":"f0602d39-4b70-5d33-81a1-44c74bc6a963","frontmatter":{"path":"/part-1/5-volumes-and-ports","title":"Interacting with the container via volumes and ports"}}},{"node":{"id":"eb754b3f-0629-5970-a322-6a4dc4564d67","frontmatter":{"path":"/part-1/6-docker-hub","title":"Utilizing tools from the Registry"}}},{"node":{"id":"d1c71e59-47d3-54fd-a486-383c8377fe36","frontmatter":{"path":"/part-1/7-summary","title":"Summary"}}},{"node":{"id":"0c108910-d460-5d9b-8099-772363806cd1","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"5ecd7aff-3a9d-5952-a0e4-50e15971e6be","frontmatter":{"path":"/part-2/1-migrating-to-docker-compose","title":"Migrating to Docker Compose"}}},{"node":{"id":"4007819b-0805-5da6-bf6a-99ded7c679ba","frontmatter":{"path":"/part-2/2-docker-networking","title":"Docker networking"}}},{"node":{"id":"663340ff-6dff-50cc-9bb2-25940e07ee07","frontmatter":{"path":"/part-2/3-volumes-in-action","title":"Volumes in action"}}},{"node":{"id":"fccc6c0d-db88-5605-9dcf-032a5afa0c28","frontmatter":{"path":"/part-2/4-containers-in-development","title":"Containers in development"}}},{"node":{"id":"d765d5bb-ef50-576a-8818-9938b2930e71","frontmatter":{"path":"/part-2/5-summary","title":"Summary"}}},{"node":{"id":"562b2219-bfee-5004-b19d-67666caa20c1","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"a43415c2-1067-541e-83ce-30fbd4938a64","frontmatter":{"path":"/part-3/1-deeper-understainding-of-containers","title":"Deeper understanding of containers"}}},{"node":{"id":"f13c2ceb-97e3-50e6-9153-9fd8c7b4eb5a","frontmatter":{"path":"/part-3/2-deployment-pipelines","title":"Deployment pipelines"}}},{"node":{"id":"baa5a147-830d-5a73-b883-2eef8b123a54","frontmatter":{"path":"/part-3/3-using-non-root-user","title":"Using a non-root user"}}},{"node":{"id":"b172f390-4ffa-568d-99e8-737985f35a70","frontmatter":{"path":"/part-3/4-optimizing-the-image-size","title":"Optimizing the image size"}}},{"node":{"id":"76657527-40ce-5179-88b3-0df3d0ae2ab9","frontmatter":{"path":"/part-3/5-multi-host-environments","title":"Multi-host environments"}}},{"node":{"id":"3405a024-ea45-5fd0-8004-ec8726591ee1","frontmatter":{"path":"/part-3/6-end","title":"End"}}}]}},"pageContext":{}},
    "staticQueryHashes": ["3294351120","994120085"]}