{"version":3,"file":"component---src-pages-sign-in-js-d22030f78f60802ef567.js","mappings":"oTAcMA,EAAMC,EAAAA,QAAAA,IAAAA,WAAU,CAAAC,YAAA,eAAAC,YAAA,gBAAVF,CAAU,2BAIhBG,EAAOH,EAAAA,QAAAA,KAAAA,WAAW,CAAAC,YAAA,gBAAAC,YAAA,gBAAXF,CAAW,MAElBI,EAAUJ,EAAAA,QAAAA,IAAAA,WAAU,CAAAC,YAAA,mBAAAC,YAAA,gBAAVF,CAAU,yBAIpBK,EAAgBL,EAAAA,QAAAA,IAAAA,WAAU,CAAAC,YAAA,yBAAAC,YAAA,gBAAVF,CAAU,kCAK1BM,EAAU,SAAAC,GAAA,SAAAD,IAAA,QAAAE,EAAAC,EAAAC,UAAAC,OAAAC,EAAA,IAAAC,MAAAJ,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAAF,EAAAE,GAAAJ,UAAAI,GAiEb,OAjEaN,EAAAD,EAAAQ,KAAA,QAAAH,IAAA,MAGdI,kBAAoB,WAElBR,EAAKS,mBAAqBC,aAAY,YAC/BC,EAAAA,EAAAA,OAGLC,YAAW,WAEsB,cAA7BC,OAAOC,SAASC,UACa,aAA7BF,OAAOC,SAASC,WAEhBF,OAAOC,SAAW,IAEtB,GAAG,IACL,GAAG,IACL,EAACd,EAMDgB,QAAO,eAAAC,GAAAC,EAAAA,EAAAA,GAAAC,IAAAA,MAAG,SAAAC,EAAOC,GAAC,OAAAF,IAAAA,MAAA,SAAAG,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OACE,GAAlBH,EAAEI,mBAEAzB,EAAK0B,MAAMC,YACkB,IAA5B3B,EAAK0B,MAAME,MAAMzB,QAA+C,IAA/BH,EAAK0B,MAAMG,SAAS1B,QAAa,CAAAmB,EAAAE,KAAA,eAAAF,EAAAQ,OAAA,iBAOnE,OAHF9B,EAAK+B,SAAS,CACZJ,YAAY,EACZK,OAAO,IACPV,EAAAC,KAAA,EAAAD,EAAAE,KAAA,GAEMS,EAAAA,EAAAA,IAAa,CACjBC,SAAUlC,EAAK0B,MAAME,MACrBC,SAAU7B,EAAK0B,MAAMG,WACrB,OAGFjB,YAAW,WACT,IACE,GAAsB,oBAAXC,OAET,YADAA,OAAOsB,QAAQC,IAAI,IAGrBC,EAAAA,EAAAA,UAAS,IACX,CAAE,MAAOC,IACPD,EAAAA,EAAAA,UAAS,IACX,CACF,GAAG,KAAIf,EAAAE,KAAA,iBAE0C,OAF1CF,EAAAC,KAAA,GAAAD,EAAAiB,GAAAjB,EAAA,SAEPtB,EAAK+B,SAAS,CAAEC,OAAO,EAAML,YAAY,IAAQL,EAAAQ,OAAA,mCAAAR,EAAAkB,OAAA,GAAApB,EAAA,mBAGpD,gBAAAqB,GAAA,OAAAxB,EAAAyB,MAAA,KAAAxC,UAAA,EAlCM,GAkCNF,EAED0B,MAAQ,CACNE,MAAO,GACPC,SAAU,GACVF,YAAY,EACZK,OAAO,GACRhC,CAAA,EAjEa2C,EAAAA,EAAAA,GAAA7C,EAAAC,GAiEb,IAAA6C,EAAA9C,EAAA+C,UAmFA,OAnFAD,EA7CDE,qBAAA,WACEC,cAAcC,KAAKvC,mBACrB,EAACmC,EA6CDK,OAAA,WAAU,IAADC,EAAA,KACP,OAAIF,KAAKG,QAAQxC,WAAaqC,KAAKtB,MAAMC,aACvCU,EAAAA,EAAAA,UAAS,KACFe,EAAAA,cAAA,WAAK,oBAGZA,EAAAA,cAACC,EAAAA,EAAM,KACLD,EAAAA,cAACE,EAAAA,EAAS,KACRF,EAAAA,cAACG,EAAAA,EAAM,CAACC,MAAOR,KAAKS,MAAMC,EAAE,kBAC5BN,EAAAA,cAACvD,EAAa,KACZuD,EAAAA,cAAA,UAAKJ,KAAKS,MAAMC,EAAE,iBAClBN,EAAAA,cAACzD,EAAI,KACHyD,EAAAA,cAACxD,EAAO,KACLoD,KAAKS,MAAMC,EAAE,mBAAoB,IAClCN,EAAAA,cAACO,EAAAA,GAAY,CACXC,KAAK,kBACLC,OAAO,SACPC,IAAI,uBACL,WAEe,IACfd,KAAKS,MAAMC,EAAE,qBAGhBN,EAAAA,cAAC7D,EAAG,KACF6D,EAAAA,cAACW,EAAAA,EAAS,CACRC,GAAG,2BACHC,QAAQ,WACRC,KAAK,OACLC,MAAOnB,KAAKS,MAAMC,EAAE,sBACpBU,WAAS,EACTC,MAAOrB,KAAKtB,MAAME,MAClB0C,SAAU,SAACC,GAAC,OAAKrB,EAAKnB,SAAS,CAAEH,MAAO2C,EAAEV,OAAOQ,OAAQ,KAG7DjB,EAAAA,cAAC7D,EAAG,KACF6D,EAAAA,cAACW,EAAAA,EAAS,CACRC,GAAG,8BACHC,QAAQ,WACRC,KAAMlB,KAAKtB,MAAM8C,aAAe,OAAS,WACzCL,MAAOnB,KAAKS,MAAMC,EAAE,iBACpBU,WAAS,EACTC,MAAOrB,KAAKtB,MAAMG,SAClByC,SAAU,SAACC,GAAC,OAAKrB,EAAKnB,SAAS,CAAEF,SAAU0C,EAAEV,OAAOQ,OAAQ,KAIhEjB,EAAAA,cAAC7D,EAAG,KACF6D,EAAAA,cAACqB,EAAAA,EAAM,CACLzD,QAASgC,KAAKhC,QACd0D,SAAU1B,KAAKtB,MAAMC,WACrBsC,QAAQ,YACRU,MAAM,UACNP,WAAS,EACTF,KAAK,UAEJlB,KAAKS,MAAMC,EAAE,mBAInBV,KAAKtB,MAAMM,OACVoB,EAAAA,cAACxD,EAAO,KACNwD,EAAAA,cAAA,SAAIJ,KAAKS,MAAMC,EAAE,uBAGrBN,EAAAA,cAAC7D,EAAG,KACF6D,EAAAA,cAACwB,EAAAA,KAAI,CAACC,GAAG,YAAY7B,KAAKS,MAAMC,EAAE,wBAEpCN,EAAAA,cAAC7D,EAAG,KACF6D,EAAAA,cAACO,EAAAA,GAAY,CACXC,KAAK,8CACLC,OAAO,SACPC,IAAI,uBAEHd,KAAKS,MAAMC,EAAE,wBAO5B,EAAC5D,CAAA,CApJa,CAASsD,EAAAA,WAAnBtD,EACGgF,YAAcC,EAAAA,GAsJvB,WAAeC,EAAAA,EAAAA,GAAgB,CAAC,SAAU,QAA1C,EACEC,EAAAA,EAAAA,IAAsBnF,G","sources":["webpack://ohjelmoinnin-mooc/./src/pages/sign-in.js"],"sourcesContent":["import React from \"react\"\nimport Helmet from \"react-helmet\"\nimport Layout from \"../templates/Layout\"\nimport { authenticate, loggedIn } from \"../services/moocfi\"\nimport { navigate, Link } from \"gatsby\"\nimport { TextField, Button } from \"@material-ui/core\"\nimport { OutboundLink } from \"gatsby-plugin-google-analytics\"\nimport { withTranslation } from \"react-i18next\"\nimport styled from \"styled-components\"\nimport LoginStateContext, {\n  withLoginStateContext,\n} from \"../contexes/LoginStateContext\"\nimport Container from \"../components/Container\"\n\nconst Row = styled.div`\n  margin-bottom: 1.5rem;\n`\n\nconst Form = styled.form``\n\nconst InfoBox = styled.div`\n  margin-bottom: 2rem;\n`\n\nconst FormContainer = styled.div`\n  height: 100%;\n  margin-top: 2rem;\n`\n\nclass SignInPage extends React.Component {\n  static contextType = LoginStateContext\n\n  componentDidMount = () => {\n    // This is a workaroud to some really weird login redirect problems\n    this.fallbackRedirector = setInterval(() => {\n      if (!loggedIn()) {\n        return\n      }\n      setTimeout(() => {\n        if (\n          window.location.pathname === \"/sign-in/\" ||\n          window.location.pathname === \"/sign-in\"\n        ) {\n          window.location = \"/\"\n        }\n      }, 2000)\n    }, 1000)\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.fallbackRedirector)\n  }\n\n  onClick = async (e) => {\n    e.preventDefault()\n    if (\n      this.state.submitting ||\n      (this.state.email.length === 0 && this.state.password.length === 0)\n    ) {\n      return\n    }\n    this.setState({\n      submitting: true,\n      error: false,\n    })\n    try {\n      await authenticate({\n        username: this.state.email,\n        password: this.state.password,\n      })\n\n      // Give loginstate time to update\n      setTimeout(() => {\n        try {\n          if (typeof window !== \"undefined\") {\n            window.history.go(-1)\n            return\n          }\n          navigate(\"/\")\n        } catch (_e) {\n          navigate(\"/\")\n        }\n      }, 100)\n    } catch (error) {\n      this.setState({ error: true, submitting: false })\n      return\n    }\n  }\n\n  state = {\n    email: \"\",\n    password: \"\",\n    submitting: false,\n    error: false,\n  }\n\n  render() {\n    if (this.context.loggedIn && !this.state.submitting) {\n      navigate(\"/\")\n      return <div>Redirecting....</div>\n    }\n    return (\n      <Layout>\n        <Container>\n          <Helmet title={this.props.t(\"common:login\")} />\n          <FormContainer>\n            <h1>{this.props.t(\"common:login\")}</h1>\n            <Form>\n              <InfoBox>\n                {this.props.t(\"user:courseUses\")}{\" \"}\n                <OutboundLink\n                  href=\"https://mooc.fi\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  mooc.fi\n                </OutboundLink>{\" \"}\n                {this.props.t(\"user:courseUses2\")}\n              </InfoBox>\n\n              <Row>\n                <TextField\n                  id=\"outlined-adornment-email\"\n                  variant=\"outlined\"\n                  type=\"text\"\n                  label={this.props.t(\"user:emailUsername\")}\n                  fullWidth\n                  value={this.state.email}\n                  onChange={(o) => this.setState({ email: o.target.value })}\n                />\n              </Row>\n              <Row>\n                <TextField\n                  id=\"outlined-adornment-password\"\n                  variant=\"outlined\"\n                  type={this.state.showPassword ? \"text\" : \"password\"}\n                  label={this.props.t(\"user:password\")}\n                  fullWidth\n                  value={this.state.password}\n                  onChange={(o) => this.setState({ password: o.target.value })}\n                />\n              </Row>\n\n              <Row>\n                <Button\n                  onClick={this.onClick}\n                  disabled={this.state.submitting}\n                  variant=\"contained\"\n                  color=\"primary\"\n                  fullWidth\n                  type=\"submit\"\n                >\n                  {this.props.t(\"common:login\")}\n                </Button>\n              </Row>\n            </Form>\n            {this.state.error && (\n              <InfoBox>\n                <b>{this.props.t(\"user:wrongDetails\")}</b>\n              </InfoBox>\n            )}\n            <Row>\n              <Link to=\"/sign-up\">{this.props.t(\"user:createAccount\")}</Link>\n            </Row>\n            <Row>\n              <OutboundLink\n                href=\"https://tmc.mooc.fi/password_reset_keys/new\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                {this.props.t(\"user:forgottenPW\")}\n              </OutboundLink>\n            </Row>\n          </FormContainer>\n        </Container>\n      </Layout>\n    )\n  }\n}\n\nexport default withTranslation([\"common\", \"user\"])(\n  withLoginStateContext(SignInPage),\n)\n"],"names":["Row","styled","displayName","componentId","Form","InfoBox","FormContainer","SignInPage","_React$Component","_this","_len","arguments","length","args","Array","_key","call","componentDidMount","fallbackRedirector","setInterval","loggedIn","setTimeout","window","location","pathname","onClick","_ref","_asyncToGenerator","_regeneratorRuntime","_callee","e","_context","prev","next","preventDefault","state","submitting","email","password","abrupt","setState","error","authenticate","username","history","go","navigate","_e","t0","stop","_x","apply","_inheritsLoose","_proto","prototype","componentWillUnmount","clearInterval","this","render","_this2","context","React","Layout","Container","Helmet","title","props","t","OutboundLink","href","target","rel","TextField","id","variant","type","label","fullWidth","value","onChange","o","showPassword","Button","disabled","color","Link","to","contextType","LoginStateContext","withTranslation","withLoginStateContext"],"sourceRoot":""}